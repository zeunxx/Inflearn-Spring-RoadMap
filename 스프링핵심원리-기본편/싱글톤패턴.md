 # ì‹±ê¸€í†¤ íŒ¨í„´

- í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ë”± 1ê°œë§Œ ìƒì„±ë˜ëŠ” ê²ƒì„ ë³´ì¥í•˜ëŠ” ë””ìì¸ íŒ¨í„´

    â†’ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ 2ê°œì´ìƒ ìƒì„±í•˜ì§€ ëª»í•˜ë„ë¡ ë§‰ìŒ
        
    : private ìƒì„±ìë¥¼ ì‚¬ìš©í•´ ì™¸ë¶€ì—ì„œ new í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì§€ ëª»í•˜ë„ë¡ ë§‰ìŒ

<br>

```
public class SingletonService {
    
    // 1. static ì˜ì—­ì— ê°ì²´ë¥¼ ë”± 1ê°œë§Œ ìƒì„±í•´ë‘ 
    private static final SingletonService instance = new SingletonService();
    
    // 2. publicìœ¼ë¡œ ì—´ì–´ì„œ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ê°€ í•„ìš”í•˜ë©´ ì´ static ë©”ì†Œë“œë¥¼ í†µí•´ì„œë§Œ ì¡°íšŒí•˜ë„ë¡ í—ˆë½
    public static SingletonService getInstance(){
        return instance;
    }

    // 3. ìƒì„±ìë¥¼ privateìœ¼ë¡œ ì„ ì–¸í•´ì„œ ì™¸ë¶€ì—ì„œ new í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•œ ê°ì²´ ìƒì„± ë§‰ìŒ
    private SingletonService(){
        
    }
    
    public void logic(){
        System.out.println("ì‹±ê¸€í†¤ ê°ì²´ ë¡œì§ í˜¸ì¶œ");
    }
}

```

```
@Test
    @DisplayName("ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì ìš©í•œ ê°ì²´ ì‚¬ìš©")
    void singletonServiceTest(){
        SingletonService singletonService1 = SingletonService.getInstance();
        SingletonService singletonService2 = SingletonService.getInstance();

        Assertions.assertThat(singletonService1).isSameAs(singletonService2);

    }
```

â¡ï¸ ê°™ì€ ê°ì²´ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ë°˜í™˜ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ!

<br>

#### ğŸ“Œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•˜ë©´ ìŠ¤í”„ë§ì´ ì•Œì•„ì„œ ê°ì²´ë“¤ì„ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬í•´ì£¼ì–´ ë”°ë¡œ ì ìš©í•  í•„ìš” ì—†ìŒ!

<br><Br>

## ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì‹±ê¸€í„´  íŒ¨í„´ì„ ì ìš©í•˜ì§€ ì•Šì•„ë„ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ ì—­í• í•¨! 
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ê¸°ëŠ¥ë•Œë¬¸ì— ì‹±ê¸€í„´ íŒ¨í„´ì˜ ë‹¨ì ì„ í•´ê²°í•˜ë©° ê°ì²´ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ìœ ì§€ í•  ìˆ˜ ìˆìŒ
    - ì‹±ê¸€í†¤ íŒ¨í„´ì„ ìœ„í•œ ì§€ì €ë¶„í•œ ì½”ë“œ ë“¤ì–´ê°€ì§€ ì•ŠìŒ
    - DIP, OCP, í…ŒìŠ¤íŠ¸, private ìƒì„±ìë¡œë¶€í„° ììœ ë¡­ê²Œ ì‹±ê¸€í†¤ ì‚¬ìš© ê°€ëŠ¥

âœ… ìŠ¤í”„ë§ ë¹ˆ = ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬ë˜ëŠ” ë¹ˆ

<br>

```
    @Test
    @DisplayName("ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì™€ ì‹±ê¸€í†¤")
    void springContainer(){
    //  AppConfig appConfig = new AppConfig();

        ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);

        // 1. ì¡°íšŒ: í˜¸ì¶œí• ë•Œë§ˆë‹¤ ê°ì²´ë¥¼ ìƒì„±
        MemberService memberService1 = ac.getBean("memberService", MemberService.class);

        // 2. ì¡°íšŒ: í˜¸ì¶œí• ë•Œë§ˆë‹¤ ê°ì²´ë¥¼ ìƒì„±
        MemberService memberService2 = ac.getBean("memberService", MemberService.class);

        // ì°¸ì¡°ê°’ì´ ë‹¤ë¥¸ ê²ƒì„ í™•ì¸
        System.out.println("memberService1 = " + memberService1);
        System.out.println("memberService2 = " + memberService2);

        //memberService1 != memberService2
        Assertions.assertThat(memberService1).isSameAs(memberService2);
    }

```

![image](https://user-images.githubusercontent.com/81572478/189321609-4df4d0b5-8ffd-4452-8f45-9b4a89e01b9c.png)

<br><Br>

## ì‹±ê¸€í†¤ ë°©ì‹ì˜ ì£¼ì˜ì 

- ì‹±ê¸€í†¤ ë°©ì‹ì€ ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸ê°€ í•˜ë‚˜ì˜ ê°™ì€ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê³µìœ í•¨ âˆ´ ì‹±ê¸€í†¤ ê°ì²´ëŠ” ìƒíƒœë¥¼ ìœ ì§€í•˜ê²Œ ì„¤ê³„í•˜ë©´ ì•ˆë¨
<br>

### ğŸ“Œì‹±ê¸€í†¤ì€ ë¬´ìƒíƒœ(stateless)ë¡œ ì„¤ê³„í•´ì•¼ í•œë‹¤
- íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ì— ì˜ì¡´ì ì¸ í•„ë“œê°€ ìˆìœ¼ë©´ ì•ˆë¨
- íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ê°€ ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆëŠ” í•„ë“œê°€ ìˆìœ¼ë©´ ì•ˆë¨
- ê°€ê¸‰ì  ì½ê¸°ë§Œ ê°€ëŠ¥í•˜ê²Œ(ìˆ˜ì • ë¶ˆê°€)
- í•„ë“œ ëŒ€ì‹ ì— ìë°”ì—ì„œ ê³µìœ ë˜ì§€ì•ŠëŠ” ì§€ì—­ë³€ìˆ˜, íŒŒë¼ë¯¸í„°, ThreadLocal ë“±ì„ ì‚¬ìš©í•´ì•¼ í•¨

```

public class StatefulService {

    private int price; // ìƒíƒœ ìœ ì§€í•˜ëŠ” í•„ë“œ

    public void order(String name, int price){
        System.out.println("name = "+name+" price = " + price);
        this.price = price; //ì—¬ê¸°ê°€ ë¬¸ì œ! 
        // price í•„ë“œëŠ” ê³µìœ ë˜ëŠ” í•„ë“œì¸ë°, íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ê°€ ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆìŒ!
    }

    public int getPrice() {
        return price;
    }
}

```
```
class StatefulServiceTest {

    @Test
    void statefulServiceSingleton(){
        ApplicationContext ac = new AnnotationConfigApplicationContext(TestConfig.class);
        StatefulService statefulService1 = ac.getBean(StatefulService.class);
        StatefulService statefulService2 = ac.getBean(StatefulService.class);

        //ThreadA : Aì‚¬ìš©ì 10000ì› ì£¼ë¬¸
        statefulService1.order("userA",10000);
        //ThreadB : Bì‚¬ìš©ì 20000ì› ì£¼ë¬¸
        statefulService2.order("userB",20000);

        //ThreadA : ì‚¬ìš©ì ì£¼ë¬¸ê¸ˆì•¡ ì¡°íšŒ
        int price = statefulService1.getPrice();
        System.out.println("price = " + price);

        // ì‹±ê¸€í†¤ì´ë¯€ë¡œ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ì´ê¸°ë•Œë¬¸ì— ê¸ˆì•¡ ì¡°íšŒ ì „ì— ë§Œì›ì´ 2ë§Œì›ìœ¼ë¡œ êµì²´ë¨
        Assertions.assertThat(statefulService1.getPrice()).isEqualTo(20000);
    }

    static class TestConfig{

        @Bean
        public StatefulService statefulService(){
            return new StatefulService();
        };
    }

}
```

âœ… ê³µìœ  í•„ë“œ ì œê±°

```
public int order(String name, int price){
        System.out.println("name = "+name+" price = " + price);
        return price;
    }

ì´ë ‡ê²Œ ë°”ê¿”ì„œ 

//ThreadA : Aì‚¬ìš©ì 10000ì› ì£¼ë¬¸
int userAprice = statefulService1.order("userA", 10000);

ê°€ê²© ë³´ë©´ ë¨
```

<br>

### ğŸ“Œ @Configurationê°€ ì ìš©ëœ ì½”ë“œì—ì„  @Beanì´ ë¶™ì€ ë©”ì†Œë“œë§ˆë‹¤ ì´ë¯¸ ìŠ¤í”„ë§ ë¹ˆì´ ì¡´ì¬í•˜ë©´ ë¹ˆì„ ë°˜í™˜, ì—†ìœ¼ë©´ ìƒì„±í•´ì„œ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡, ë°˜í™˜ í•˜ëŠ” ì½”ë“œê°€ ë™ì ìœ¼ë¡œ ìƒì„±ë¨(AppConfig@CGLIB)

- @Configurationì—†ì´ @Beanë§Œ ì ìš©í•˜ë©´ 
    - AppConfig@CGLIBì´ ì•„ë‹Œ AppConfigê°€ ë“±ë¡ë¨
    - ì‹±ê¸€í†¤ ê¹¨ì§