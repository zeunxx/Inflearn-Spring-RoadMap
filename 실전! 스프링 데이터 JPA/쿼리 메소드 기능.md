## ì¿¼ë¦¬ ë©”ì†Œë“œ ê¸°ëŠ¥



### 1ï¸âƒ£ ë©”ì†Œë“œ ì´ë¦„ìœ¼ë¡œ ì¿¼ë¦¬ ìƒì„±

```
ğŸ’¡ ìˆœìˆ˜ spring jpa ë ˆí¬ì§€í† ë¦¬

    public List<Member> findByUsernameAndAgeGreaterThan(String username, int age) {
        return em.createQuery("select m from Member m where m.username = :username and m.age > :age")
                .setParameter("username", username)
                .setParameter("age", age)
                .getResultList();
    }

ğŸ’¡ spring data jpa ë ˆí¬ì§€í† ë¦¬

    List<Member> findByUsernameAndAgeGreaterThan(String username, int age);

```
- ìŠ¤í”„ë§ ë°ì´í„° JPAëŠ” ë©”ì†Œë“œ ì´ë¦„ì„ ë¶„ì„í•´ì„œ JPQLì„ ìƒì„±í•˜ê³  ì‹¤í–‰

<BR>

âœ… ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ ì œê³µí•˜ëŠ” ì¿¼ë¦¬ ë©”ì†Œë“œ ê¸°ëŠ¥

- ì¡°íšŒ: findâ€¦By ,readâ€¦By ,queryâ€¦By getâ€¦By, 
    - EX) findHelloBy ì²˜ëŸ¼ ...ì— ì‹ë³„í•˜ê¸° ìœ„í•œ ë‚´ìš©(ì„¤ëª…)ì´ ë“¤ì–´ê°€ë„ ëœë‹¤.
- COUNT: countâ€¦By ë°˜í™˜íƒ€ì… long
- EXISTS: existsâ€¦By ë°˜í™˜íƒ€ì… boolean
- ì‚­ì œ: deleteâ€¦By, removeâ€¦By ë°˜í™˜íƒ€ì… long
- DISTINCT: findDistinct, findMemberDistinctBy
- LIMIT: findFirst3, findFirst, findTop, findTop3

<BR>

> ì°¸ê³ : ì´ ê¸°ëŠ¥ì€ ì—”í‹°í‹°ì˜ í•„ë“œëª…ì´ ë³€ê²½ë˜ë©´ ì¸í„°í˜ì´ìŠ¤ì— ì •ì˜í•œ ë©”ì„œë“œ ì´ë¦„ë„ ê¼­ í•¨ê»˜ ë³€ê²½í•´ì•¼ í•œë‹¤. 
ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹œì‘í•˜ëŠ” ì‹œì ì— ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.
> ì´ë ‡ê²Œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œë”© ì‹œì ì— ì˜¤ë¥˜ë¥¼ ì¸ì§€í•  ìˆ˜ ìˆëŠ” ê²ƒì´ ìŠ¤í”„ë§ ë°ì´í„° JPAì˜ ë§¤ìš° í° ì¥ì ì´ë‹¤.

<BR>

### 2ï¸âƒ£ ë©”ì†Œë“œ ì´ë¦„ìœ¼ë¡œ JPA NamedQuery í˜¸ì¶œ
- ì‹¤ë¬´ì—ì„œ ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ

```
ğŸ’¡ ì—”í‹°í‹°

    @Entity
    @NamedQuery(
        name="Member.findByUsername",
        query = "select m from Member m where m.username = :username"
    )
    public class Member {

        @Id @GeneratedValue
        @Column(name="member_id")
        private Long id;
        ...

    }

ğŸ’¡ ìˆœìˆ˜ spring jpa ë ˆí¬ì§€í† ë¦¬ 

    public List<Member> findByUsername(String username){
        return em.createNamedQuery("Member.findByUsername",Member.class)
                .setParameter("username",username)
                .getResultList();
    }

ğŸ’¡ spring data jpa ë ˆí¬ì§€í† ë¦¬

    @Query(name = "Member.findByUsername") // @Query ë¥¼ ìƒëµí•˜ê³  ë©”ì„œë“œ ì´ë¦„ë§Œìœ¼ë¡œ Named ì¿¼ë¦¬ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŒ!
    List<Member> findByUsername(@Param("username") String username);

```

- ìŠ¤í”„ë§ ë°ì´í„° JPAëŠ” ì„ ì–¸í•œ "ë„ë©”ì¸ í´ë˜ìŠ¤ + .(ì ) + ë©”ì„œë“œ ì´ë¦„"ìœ¼ë¡œ Named ì¿¼ë¦¬ë¥¼ ì°¾ì•„ì„œ ì‹¤í–‰
- ë§Œì•½ ì‹¤í–‰í•  Named ì¿¼ë¦¬ê°€ ì—†ìœ¼ë©´ ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ì¿¼ë¦¬ ìƒì„± ì „ëµì„ ì‚¬ìš©
- í•„ìš”í•˜ë©´ ì „ëµì„ ë³€ê²½í•  ìˆ˜ ìˆì§€ë§Œ ê¶Œì¥í•˜ì§€ ì•ŠìŒ!

<br>

### 3ï¸âƒ£ @Query ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ì„œ ë¦¬íŒŒì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤ì— ì¿¼ë¦¬ ì§ì ‘ ì •ì˜

```
ğŸ’¡ spring data jpa ë ˆí¬ì§€í† ë¦¬

    @Query("select m from Member m where m.username = :username and m.age = :age")
    List<Member> findUser(@Param("username") String username, @Param("age") int age);
```
- ì‹¤í–‰í•  ë©”ì„œë“œì— ì •ì  ì¿¼ë¦¬ë¥¼ ì§ì ‘ ì‘ì„±í•˜ë¯€ë¡œ ì´ë¦„ ì—†ëŠ” Named ì¿¼ë¦¬ë¼ í•  ìˆ˜ ìˆìŒ
- JPA Named ì¿¼ë¦¬ì²˜ëŸ¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œì ì— ë¬¸ë²• ì˜¤ë¥˜ë¥¼ ë°œê²¬í•  ìˆ˜ ìˆìŒ(ë§¤ìš° í° ì¥ì !)

<br>

> ì°¸ê³ : ì‹¤ë¬´ì—ì„œëŠ” ```ë©”ì†Œë“œ ì´ë¦„ìœ¼ë¡œ ì¿¼ë¦¬ ìƒì„± ê¸°ëŠ¥```ì€ íŒŒë¼ë¯¸í„°ê°€ ì¦ê°€í•˜ë©´ ë©”ì„œë“œ ì´ë¦„ì´ ë§¤ìš° ì§€ì €ë¶„í•´ì§„ë‹¤. ë”°ë¼ì„œ @Query ê¸°ëŠ¥ì„ ìì£¼ ì‚¬ìš©í•˜ê²Œ ëœë‹¤


<br>

### âœ… @Queryë¡œ ê°’, DTO ì¡°íšŒí•˜ê¸° 

#### 1. ë‹¨ìˆœíˆ ê°’ í•˜ë‚˜ë¥¼ ì¡°íšŒ

```
    @Query("select m.username from Member m")
    List<String> findUsernameList();
```

#### 2. DTO ì¡°íšŒ

```
    @Query("select new study.datajpa.dto.MemberDto(m.id, m.username, t.name) from Member m join m.team t")
    List<MemberDto> findMemberDto();
```

<br>

### íŒŒë¼ë¯¸í„° ë°”ì¸ë”©

- ìœ„ì¹˜ ê¸°ë°˜
- ì´ë¦„ ê¸°ë°˜


```
select m from Member m where m.username = ?0 //ìœ„ì¹˜ ê¸°ë°˜
select m from Member m where m.username = :name //ì´ë¦„ ê¸°ë°˜


@Query("select m from Member m where m.username = :name")
Member findMembers(@Param("name") String username);

```


> ì°¸ê³ : ì½”ë“œ ê°€ë…ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ë¥¼ ìœ„í•´ ì´ë¦„ ê¸°ë°˜ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ì„ ì‚¬ìš©í•˜ì (ìœ„ì¹˜ê¸°ë°˜ì€ ìˆœì„œ ì‹¤ìˆ˜ê°€
ë°”ê¾¸ë©´â€¦)


<br>

ğŸ’¡ **ì»¬ë ‰ì…˜ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©**
- Collection íƒ€ì…ìœ¼ë¡œ inì ˆ ì§€ì›

```
@Query("select m from Member m where m.username in :names")
List<Member> findByNames(@Param("names") List<String> names);
```

<br><Br>

### ë°˜í™˜ íƒ€ì…

- ìŠ¤í”„ë§ ë°ì´í„° JPAëŠ” ìœ ì—°í•œ ë°˜í™˜ íƒ€ì… ì§€ì›
```
    List<Member> findListByUsername(String username); // ì»¬ë ‰ì…˜
    Member findMemberByUsername(String username); // ë‹¨ê±´
    Optional<Member> findOptionalByUsername(String username); // ë‹¨ê±´ Optional
```

 ğŸ“Œì¡°íšŒ ê²°ê³¼ê°€ ë§ê±°ë‚˜ ì—†ìœ¼ë©´?
- ì»¬ë ‰ì…˜
    - ê²°ê³¼ ì—†ìŒ: ë¹ˆ ì»¬ë ‰ì…˜ ë°˜í™˜
- ë‹¨ê±´ ì¡°íšŒ
    - ê²°ê³¼ ì—†ìŒ: null ë°˜í™˜
    - ê²°ê³¼ê°€ 2ê±´ ì´ìƒ: javax.persistence.NonUniqueResultException ì˜ˆì™¸ ë°œìƒ

> ì°¸ê³ : ë‹¨ê±´ìœ¼ë¡œ ì§€ì •í•œ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ìŠ¤í”„ë§ ë°ì´í„° JPAëŠ” ë‚´ë¶€ì—ì„œ JPQLì˜
Query.getSingleResult() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤. ì´ ë©”ì„œë“œë¥¼ í˜¸ì¶œí–ˆì„ ë•Œ ì¡°íšŒ ê²°ê³¼ê°€ ì—†ìœ¼ë©´
javax.persistence.NoResultException ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ”ë° ê°œë°œì ì…ì¥ì—ì„œ ë‹¤ë£¨ê¸°ê°€ ìƒë‹¹íˆ
ë¶ˆí¸í•˜ë‹¤. ìŠ¤í”„ë§ ë°ì´í„° JPAëŠ” ë‹¨ê±´ì„ ì¡°íšŒí•  ë•Œ ì´ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ì˜ˆì™¸ë¥¼ ë¬´ì‹œí•˜ê³  ëŒ€ì‹ ì— null ì„
ë°˜í™˜í•œë‹¤.