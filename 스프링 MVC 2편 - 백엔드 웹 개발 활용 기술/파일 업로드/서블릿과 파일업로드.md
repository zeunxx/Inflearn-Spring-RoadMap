## ì„œë¸”ë¦¿ê³¼ íŒŒì¼ ì—…ë¡œë“œ

```
public String saveFileV1(HttpServletRequest request) throws ServletException, IOException {
    log.info("request={}",request);

    String itemName = request.getParameter("itemName");
    log.info("itemName={}",itemName);

    Collection<Part> parts = request.getParts();
    log.info("part={}",parts);

    return "upload-form";
}
```

request.getParts() : multipart/form-data ì „ì†¡ ë°©ì‹ì—ì„œ ê°ê° 
ë‚˜ëˆ„ì–´ì§„ ë¶€ë¶„ì„ ë°›ì•„ì„œ í™•ì¸í•  ìˆ˜ìˆë‹¤

<br>

#### ë©€í‹°íŒŒíŠ¸ ì‚¬ìš© ì˜µì…˜

ğŸ“Œ ì—…ë¡œë“œ ì‚¬ì´ì¦ˆ ì œí•œ
```
pring.servlet.multipart.max-file-size=1MB
spring.servlet.multipart.max-request-size=10MB
```

í° íŒŒì¼ì„ ë¬´ì œí•œ ì—…ë¡œë“œí•˜ê²Œ ë‘˜ ìˆ˜ëŠ” ì—†ìœ¼ë¯€ë¡œ ì—…ë¡œë“œ ì‚¬ì´ì¦ˆë¥¼ ì œí•œí•  ìˆ˜ ìˆë‹¤.

ì‚¬ì´ì¦ˆë¥¼ ë„˜ìœ¼ë©´ ì˜ˆì™¸( SizeLimitExceededException )ê°€ ë°œìƒí•œë‹¤.

- max-file-size : íŒŒì¼ í•˜ë‚˜ì˜ ìµœëŒ€ ì‚¬ì´ì¦ˆ, ê¸°ë³¸ 1MB


<br>

ğŸ“Œ spring.servlet.multipart.enabled ë„ê¸°(ê¸°ë³¸ true)
`spring.servlet.multipart.enabled=false`

â¡ï¸ ê²°ê³¼ ë¡œê·¸
```
request=org.apache.catalina.connector.RequestFacade@xxx
itemName=null
parts=[]
```

ë©€í‹°íŒŒíŠ¸ëŠ” ì¼ë°˜ì ì¸ í¼ ìš”ì²­ì¸ application/x-www-form-urlencoded ë³´ë‹¤ í›¨ì”¬ ë³µì¡í•˜ë‹¤.
spring.servlet.multipart.enabled ì˜µì…˜ì„ ë„ë©´ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆëŠ” **ë©€í‹°íŒŒíŠ¸ì™€ ê´€ë ¨ëœ ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•ŠëŠ”ë‹¤.**

ê·¸ë˜ì„œ ê²°ê³¼ ë¡œê·¸ë¥¼ ë³´ë©´ request.getParameter("itemName") , request.getParts() ì˜ ê²°ê³¼ê°€ ë¹„ì–´ìˆë‹¤. 

- ì´ ì˜µì…˜ì„ ì¼œë©´ ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆì—ê²Œ ë©€í‹°íŒŒíŠ¸ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ë¼ê³  ì„¤ì •í•œë‹¤. 
- ì°¸ê³ ë¡œ ê¸°ë³¸ ê°’ì€ true ì´ë‹¤.


â¡ï¸ true ì‹œ ê²°ê³¼ ë¡œê·¸
```
request=org.springframework.web.multipart.support.StandardMultipartHttpServletR
equest
itemName=Spring
parts=[ApplicationPart1, ApplicationPart2]
```

request.getParameter("itemName") ì˜ ê²°ê³¼ë„ ì˜ ì¶œë ¥ë˜ê³ , request.getParts() ì—ë„ ìš”ì²­í•œ ë‘
ê°€ì§€ ë©€í‹°íŒŒíŠ¸ì˜ ë¶€ë¶„ ë°ì´í„°ê°€ í¬í•¨ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì´ ì˜µì…˜ì„ ì¼œë©´ ë³µì¡í•œ ë©€í‹°íŒŒíŠ¸ ìš”ì²­ì„
ì²˜ë¦¬í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ì œê³µí•œë‹¤.


ë¡œê·¸ë¥¼ ë³´ë©´ HttpServletRequest ê°ì²´ê°€ RequestFacade â¡ï¸ StandardMultipartHttpServletRequest ë¡œ ë³€í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

<br><Br>

> ì°¸ê³ 
> spring.servlet.multipart.enabled ì˜µì…˜ì„ ì¼œë©´ ìŠ¤í”„ë§ì˜ DispatcherServlet ì—ì„œ ë©€í‹°íŒŒíŠ¸ ë¦¬ì¡¸ë²„( MultipartResolver )ë¥¼ ì‹¤í–‰í•œë‹¤.
> ë©€í‹°íŒŒíŠ¸ ë¦¬ì¡¸ë²„ëŠ” ë©€í‹°íŒŒíŠ¸ ìš”ì²­ì¸ ê²½ìš° ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ì „ë‹¬í•˜ëŠ” ì¼ë°˜ì ì¸ HttpServletRequest ë¥¼ MultipartHttpServletRequest ë¡œ ë³€í™˜í•´ì„œ ë°˜í™˜í•œë‹¤.
> MultipartHttpServletRequest ëŠ” HttpServletRequest ì˜ ìì‹ ì¸í„°í˜ì´ìŠ¤ì´ê³ , ë©€í‹°íŒŒíŠ¸ì™€ ê´€ë ¨ëœ ì¶”ê°€ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
>
> ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ê¸°ë³¸ ë©€í‹°íŒŒíŠ¸ ë¦¬ì¡¸ë²„ëŠ” MultipartHttpServletRequest ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ StandardMultipartHttpServletRequest ë¥¼ ë°˜í™˜í•œë‹¤.
> ì´ì œ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ HttpServletRequest ëŒ€ì‹ ì— MultipartHttpServletRequest ë¥¼ ì£¼ì…ë°›ì„ ìˆ˜ ìˆëŠ”ë°, 
> ì´ê²ƒì„ ì‚¬ìš©í•˜ë©´ ë©€í‹°íŒŒíŠ¸ì™€ ê´€ë ¨ëœ ì—¬ëŸ¬ê°€ì§€ ì²˜ë¦¬ë¥¼ í¸ë¦¬í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤. 
> ê·¸ëŸ°ë° ì´í›„ ê°•ì˜ì—ì„œ ì„¤ëª…í•  MultipartFile ì´ë¼ëŠ” ê²ƒì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” í¸í•˜ê¸° ë•Œë¬¸ì— MultipartHttpServletRequest ë¥¼ ì˜ ì‚¬ìš©í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤. ë” ìì„¸í•œ ë‚´ìš©ì€ MultipartResolver ë¥¼ ê²€ìƒ‰í•´ë³´ì.

<Br><Br>


### ì„œë¸”ë¦¿ê³¼ íŒŒì¼ ì—…ë¡œë“œ2


íŒŒì¼ì„ ì—…ë¡œë“œë¥¼ í•˜ë ¤ë©´ ì‹¤ì œ íŒŒì¼ì´ ì €ì¥ë˜ëŠ” ê²½ë¡œê°€ í•„ìš”í•˜ë‹¤.


#### application.properties
`file.dir=íŒŒì¼ ì—…ë¡œë“œ ê²½ë¡œ ì„¤ì •(ì˜ˆ): /Users/kimyounghan/study/file/`

```
@PostMapping("/upload")
public String saveFileV1(HttpServletRequest request) throws ServletException, IOException {
    log.info("request={}",request);

    String itemName = request.getParameter("itemName");
    log.info("itemName={}",itemName);

    Collection<Part> parts = request.getParts();
    log.info("part={}",parts);

    for (Part part : parts) {
        log.info("=== PART ===");
        log.info("name={}",part.getName());
        Collection<String> headerNames = part.getHeaderNames();
        for (String headerName : headerNames) {
            log.info("header {}: {}",headerName, part.getHeader(headerName));
        }

        //í¸ì˜ ë©”ì„œë“œ
        //content-disposition; filename
        log.info("submittedFilename={}",part.getSubmittedFileName());
        log.info("size={}",part.getSize());

        // ë°ì´í„° ì½ê¸°
        InputStream inputStream = part.getInputStream();
        String body = StreamUtils.copyToString(inputStream, StandardCharsets.UTF_8);
        log.info("body={}",body);

        //íŒŒì¼ì— ì €ì¥í•˜ê¸°
        if(StringUtils.hasText(part.getSubmittedFileName())){
            String fullPath = fileDir + part.getSubmittedFileName();
            log.info("íŒŒì¼ ì €ì¥ fullPath={}",fullPath);

            part.write(fullPath);
        }
    }

    return "upload-form";
}
```


```
@Value("${file.dir}")
private String fileDir;
```

application.properties ì—ì„œ ì„¤ì •í•œ file.dir ì˜ ê°’ì„ ì£¼ì…í•œë‹¤.


ë©€í‹°íŒŒíŠ¸ í˜•ì‹ì€ ì „ì†¡ ë°ì´í„°ë¥¼ í•˜ë‚˜í•˜ë‚˜ ê°ê° ë¶€ë¶„( Part )ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì „ì†¡í•œë‹¤. parts ì—ëŠ” ì´ë ‡ê²Œ ë‚˜ëˆ„ì–´ì§„ ë°ì´í„°ê°€ ê°ê° ë‹´ê¸´ë‹¤.

ì„œë¸”ë¦¿ì´ ì œê³µí•˜ëŠ” Part ëŠ” ë©€í‹°íŒŒíŠ¸ í˜•ì‹ì„ í¸ë¦¬í•˜ê²Œ ì½ì„ ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ë©”ì„œë“œë¥¼ ì œê³µí•œë‹¤.

<br>

#### Part ì£¼ìš” ë©”ì„œë“œ
- part.getSubmittedFileName() : í´ë¼ì´ì–¸íŠ¸ê°€ ì „ë‹¬í•œ íŒŒì¼ëª…
- part.getInputStream(): Partì˜ ì „ì†¡ ë°ì´í„°ë¥¼ ì½ì„ ìˆ˜ ìˆë‹¤.
- part.write(...): Partë¥¼ í†µí•´ ì „ì†¡ëœ ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆë‹¤.

<br>

> ì°¸ê³ 
> í° ìš©ëŸ‰ì˜ íŒŒì¼ì„ ì—…ë¡œë“œë¥¼ í…ŒìŠ¤íŠ¸ í•  ë•ŒëŠ” ë¡œê·¸ê°€ ë„ˆë¬´ ë§ì´ ë‚¨ì•„ì„œ ë‹¤ìŒ ì˜µì…˜ì„ ë„ëŠ” ê²ƒì´ ì¢‹ë‹¤. 
> logging.level.org.apache.coyote.http11=debug
> ë‹¤ìŒ ë¶€ë¶„ë„ íŒŒì¼ì˜ ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¥¼ ëª¨ë‘ ì¶œë ¥í•˜ë¯€ë¡œ ë„ëŠ” ê²ƒì´ ì¢‹ë‹¤.
> log.info("body={}", body);



ì„œë¸”ë¦¿ì´ ì œê³µí•˜ëŠ” Part ëŠ” í¸í•˜ê¸°ëŠ” í•˜ì§€ë§Œ, HttpServletRequest ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ê³ , ì¶”ê°€ë¡œ íŒŒì¼
ë¶€ë¶„ë§Œ êµ¬ë¶„í•˜ë ¤ë©´ ì—¬ëŸ¬ê°€ì§€ ì½”ë“œë¥¼ ë„£ì–´ì•¼ í•œë‹¤. ì´ë²ˆì—ëŠ” ìŠ¤í”„ë§ì´ ì´ ë¶€ë¶„ì„ ì–¼ë§ˆë‚˜ í¸ë¦¬í•˜ê²Œ ì œê³µí•˜ëŠ”ì§€ í™•ì¸í•´ë³´ì.