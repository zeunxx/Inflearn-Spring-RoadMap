## ì˜ˆì™¸ì²˜ë¦¬ì™€ ì˜¤ë¥˜ í˜ì´ì§€ - ì„œë¸”ë¦¿ ì˜ˆì™¸ ì²˜ë¦¬

ìŠ¤í”„ë§ì´ ì•„ë‹Œ ìˆœìˆ˜ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆëŠ” ì˜ˆì™¸ë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ëŠ”ì§€ ì•Œì•„ë³´ì.
<br>

**ì„œë¸”ë¦¿ ì˜ˆì™¸ ì²˜ë¦¬ ë°©ì‹**
- Exception(ì˜ˆì™¸)
- response.sendError(HTTP ìƒíƒœ ì½”ë“œ, ì˜¤ë¥˜ ë©”ì‹œì§€)

<br>
<br>

### Exception ì˜ˆì™¸


#### ìë°” ì§ì ‘ ì‹¤í–‰

ìë°”ì˜ ë©”ì¸ ë©”ì„œë“œë¥¼ ì§ì ‘ ì‹¤í–‰í•˜ëŠ” ê²½ìš° main ì´ë¼ëŠ” ì´ë¦„ì˜ ì“°ë ˆë“œê°€ ì‹¤í–‰ëœë‹¤.

ì‹¤í–‰ ë„ì¤‘ì— ì˜ˆì™¸ë¥¼ ì¡ì§€ ëª»í•˜ê³  ì²˜ìŒ ì‹¤í–‰í•œ main() ë©”ì„œë“œë¥¼ ë„˜ì–´ì„œ ì˜ˆì™¸ê°€ ë˜ì ¸ì§€ë©´, ì˜ˆì™¸ ì •ë³´ë¥¼
ë‚¨ê¸°ê³  í•´ë‹¹ ì“°ë ˆë“œëŠ” ì¢…ë£Œëœë‹¤.

<br>

#### ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜

ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì‚¬ìš©ì ìš”ì²­ë³„ë¡œ ë³„ë„ì˜ ì“°ë ˆë“œê°€ í• ë‹¹ë˜ê³ , ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ ì‹¤í–‰ëœë‹¤.

ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí–ˆëŠ”ë°, ì–´ë””ì„ ê°€ try ~ catchë¡œ ì˜ˆì™¸ë¥¼ ì¡ì•„ì„œ ì²˜ë¦¬í•˜ë©´ ì•„ë¬´ëŸ° ë¬¸ì œê°€
ì—†ë‹¤. 

ê·¸ëŸ°ë° ë§Œì•½ì— ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì˜ˆì™¸ë¥¼ ì¡ì§€ ëª»í•˜ê³ , ì„œë¸”ë¦¿ ë°–ìœ¼ë¡œ ê¹Œì§€ ì˜ˆì™¸ê°€ ì „ë‹¬ë˜ë©´ ì–´ë–»ê²Œ ë™ì‘í• ê¹Œ?


`WAS(ì—¬ê¸°ê¹Œì§€ ì „íŒŒ) <- í•„í„° <- ì„œë¸”ë¦¿ <- ì¸í„°ì…‰í„° <- ì»¨íŠ¸ë¡¤ëŸ¬(ì˜ˆì™¸ë°œìƒ)`

<br>

ê²°êµ­ í†°ìº£ ê°™ì€ WAS ê¹Œì§€ ì˜ˆì™¸ê°€ ì „ë‹¬ëœë‹¤. WASëŠ” ì˜ˆì™¸ê°€ ì˜¬ë¼ì˜¤ë©´ ì–´ë–»ê²Œ ì²˜ë¦¬í•´ì•¼ í• ê¹Œ?

<br>

ì•„ë¬´ì‚¬ì´íŠ¸ë‚˜ í˜¸ì¶œí•´ë³´ì.
- `http://localhost:8080/no-page`
```
HTTP Status 500 â€“ Internal Server Error
```

ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ê°œë°œì ëª¨ë“œë¡œ í™•ì¸í•´ë³´ë©´ HTTP ìƒíƒœ ì½”ë“œê°€ 500ìœ¼ë¡œ ë³´ì¸ë‹¤.

Exception ì˜ ê²½ìš° ì„œë²„ ë‚´ë¶€ì—ì„œ ì²˜ë¦¬í•  ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê²ƒìœ¼ë¡œ ìƒê°í•´ì„œ HTTP ìƒíƒœ ì½”ë“œ 500ì„
ë°˜í™˜í•œë‹¤.


â¡ï¸ í†°ìº£ì´ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•˜ëŠ” 500 ì˜¤ë¥˜ í™”ë©´ì„ ë³¼ ìˆ˜ ìˆë‹¤.

<br><Br>

#### response.sendError(HTTP ìƒíƒœ ì½”ë“œ, ì˜¤ë¥˜ ë©”ì‹œì§€)
ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ë•Œ HttpServletResponse ê°€ ì œê³µí•˜ëŠ” sendError ë¼ëŠ” ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ë„ ëœë‹¤. 
ì´ê²ƒì„ í˜¸ì¶œí•œë‹¤ê³  ë‹¹ì¥ ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ” ê²ƒì€ ì•„ë‹ˆì§€ë§Œ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆì—ê²Œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤ëŠ” ì ì„ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤.
ì´ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ HTTP ìƒíƒœ ì½”ë“œì™€ ì˜¤ë¥˜ ë©”ì‹œì§€ë„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.

- response.sendError(HTTP ìƒíƒœ ì½”ë“œ)
- response.sendError(HTTP ìƒíƒœ ì½”ë“œ, ì˜¤ë¥˜ ë©”ì‹œì§€)

```
@GetMapping("/error-404")
public void error404(HttpServletResponse response) throws IOException {
    response.sendError(404, "404ì˜¤ë¥˜!");
}

@GetMapping("/error-500")
public void error500(HttpServletResponse response) throws IOException {
    response.sendError(500 );
}

```

<Br>

#### sendError íë¦„
```
WAS(sendError í˜¸ì¶œ ê¸°ë¡ í™•ì¸) <- í•„í„° <- ì„œë¸”ë¦¿ <- ì¸í„°ì…‰í„° <- ì»¨íŠ¸ë¡¤ëŸ¬(response.sendError())
```

response.sendError() ë¥¼ í˜¸ì¶œí•˜ë©´ response ë‚´ë¶€ì—ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤ëŠ” ìƒíƒœë¥¼ ì €ì¥í•´ë‘”ë‹¤.
ê·¸ë¦¬ê³  ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆëŠ” ê³ ê°ì—ê²Œ ì‘ë‹µ ì „ì— response ì— sendError() ê°€ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤. 
ê·¸ë¦¬ê³  í˜¸ì¶œë˜ì—ˆë‹¤ë©´ ì„¤ì •í•œ ì˜¤ë¥˜ ì½”ë“œì— ë§ì¶”ì–´ ê¸°ë³¸ ì˜¤ë¥˜ í˜ì´ì§€ë¥¼ ë³´ì—¬ì¤€ë‹¤.


ì‹¤í–‰í•´ë³´ë©´ ë‹¤ìŒì²˜ëŸ¼ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•˜ëŠ” ì˜¤ë¥˜ í™”ë©´ì„ ë³¼ ìˆ˜ ìˆë‹¤

<img width="307" alt="image" src="https://github.com/zeunxx/Inflearn-Spring-RoadMap/assets/81572478/1816ca40-830f-4edf-be94-d466ecee7a88">


<Br>

#### ì •ë¦¬
ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ì œê³µí•˜ëŠ” ê¸°ë³¸ ì˜ˆì™¸ ì²˜ë¦¬ í™”ë©´ì€ ì‚¬ìš©ìê°€ ë³´ê¸°ì— ë¶ˆí¸í•˜ë‹¤. ì˜ë¯¸ ìˆëŠ” ì˜¤ë¥˜ í™”ë©´ì„
ì œê³µí•´ë³´ì.

<br><Br>

### ì„œë¸”ë¦¿ ì˜ˆì™¸ì²˜ë¦¬ - ì˜¤ë¥˜ í™”ë©´ ì œê³µ

ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ì œê³µí•˜ëŠ” ê¸°ë³¸ ì˜ˆì™¸ ì²˜ë¦¬ í™”ë©´ì€ ê³ ê° ì¹œí™”ì ì´ì§€ ì•Šë‹¤. ì„œë¸”ë¦¿ì´ ì œê³µí•˜ëŠ” ì˜¤ë¥˜ í™”ë©´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ë³´ì.

<br>

ì„œë¸”ë¦¿ì€ Exception (ì˜ˆì™¸)ê°€ ë°œìƒí•´ì„œ ì„œë¸”ë¦¿ ë°–ìœ¼ë¡œ ì „ë‹¬ë˜ê±°ë‚˜ ë˜ëŠ” response.sendError() ê°€ í˜¸ì¶œ ë˜ì—ˆì„ ë•Œ ê°ê°ì˜ ìƒí™©ì— ë§ì¶˜ ì˜¤ë¥˜ ì²˜ë¦¬ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.


ì´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë©´ ì¹œì ˆí•œ ì˜¤ë¥˜ ì²˜ë¦¬ í™”ë©´ì„ ì¤€ë¹„í•´ì„œ ê³ ê°ì—ê²Œ ë³´ì—¬ì¤„ ìˆ˜ ìˆë‹¤

<Br>

ê³¼ê±°ì—ëŠ” web.xml ì´ë¼ëŠ” íŒŒì¼ì— ì˜¤ë¥˜ í™”ë©´ì„ ë“±ë¡í–ˆë‹¤.

ì§€ê¸ˆì€ ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ í†µí•´ì„œ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ê¸° ë•Œë¬¸ì—, ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„
ì‚¬ìš©í•´ì„œ ì„œë¸”ë¦¿ ì˜¤ë¥˜ í˜ì´ì§€ë¥¼ ë“±ë¡í•˜ë©´ ëœë‹¤.

<br>

```

@Component
public class WebServerCustomizer implements WebServerFactoryCustomizer<ConfigurableWebServerFactory> {
    @Override
    public void customize(ConfigurableWebServerFactory factory) {

        ErrorPage errorPage404 = new ErrorPage(HttpStatus.NOT_FOUND, "/error-page/400");
        ErrorPage errorPage500 = new ErrorPage(HttpStatus.INTERNAL_SERVER_ERROR, "/error-page/500");
        ErrorPage errorPageEx = new ErrorPage(RuntimeException.class, "/error-page/500");

        factory.addErrorPages(errorPage404,errorPage500,errorPageEx);
    }
}

```

- response.sendError(404) : errorPage404 í˜¸ì¶œ
- response.sendError(500) : errorPage500 í˜¸ì¶œ
- RuntimeException ë˜ëŠ” ê·¸ ìì‹ íƒ€ì…ì˜ ì˜ˆì™¸: errorPageEx í˜¸ì¶œ

<br>

500 ì˜ˆì™¸ê°€ ì„œë²„ ë‚´ë¶€ì—ì„œ ë°œìƒí•œ ì˜¤ë¥˜ë¼ëŠ” ëœ»ì„ í¬í•¨í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ì—¬ê¸°ì„œëŠ” ì˜ˆì™¸ê°€ ë°œìƒí•œ ê²½ìš°ë„ 500 ì˜¤ë¥˜ í™”ë©´ìœ¼ë¡œ ì²˜ë¦¬í–ˆë‹¤.

<br>

ì˜¤ë¥˜ í˜ì´ì§€ëŠ” ì˜ˆì™¸ë¥¼ ë‹¤ë£° ë•Œ í•´ë‹¹ ì˜ˆì™¸ì™€ ê·¸ ìì‹ íƒ€ì…ì˜ ì˜¤ë¥˜ë¥¼ í•¨ê»˜ ì²˜ë¦¬í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ ìœ„ì˜ ê²½ìš°
RuntimeException ì€ ë¬¼ë¡ ì´ê³  RuntimeException ì˜ ìì‹ë„ í•¨ê»˜ ì²˜ë¦¬í•œë‹¤.
<Br>

ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ë•Œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í•„ìš”í•˜ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ RuntimeException ì˜ˆì™¸ê°€
ë°œìƒí•˜ë©´ errorPageEx ì—ì„œ ì§€ì •í•œ /error-page/500 ì´ í˜¸ì¶œëœë‹¤.
- í•´ë‹¹ ì˜¤ë¥˜ë¥¼ ì²˜ë¦¬í•  ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í•„ìš”í•¨!!

<Br>

```
@Slf4j
@Controller
public class ErrorPageController {

    @RequestMapping("/error-page/404")
    public String errorPage404(HttpServletRequest request, HttpServletResponse response){
        log.info("error Page 404");
        return "error-page/404";
    }

    @RequestMapping("/error-page/500")
    public String errorPage500(HttpServletRequest request, HttpServletResponse response){
        log.info("error Page 500");
        return "error-page/500";
    }
}


```

ì„¤ì •í•œ ì˜¤ë¥˜ í˜ì´ì§€ê°€ ì •ìƒ ë…¸ì¶œë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

<br><Br>

### ì„œë¸”ë¦¿ ì˜ˆì™¸ ì²˜ë¦¬ - ì˜¤ë¥˜ í˜ì´ì§€ ì‘ë™ ì›ë¦¬

ì„œë¸”ë¦¿ì€ Exception (ì˜ˆì™¸)ê°€ ë°œìƒí•´ì„œ ì„œë¸”ë¦¿ ë°–ìœ¼ë¡œ ì „ë‹¬ë˜ê±°ë‚˜ ë˜ëŠ” response.sendError() ê°€ í˜¸ì¶œ
ë˜ì—ˆì„ ë•Œ ì„¤ì •ëœ ì˜¤ë¥˜ í˜ì´ì§€ë¥¼ ì°¾ëŠ”ë‹¤

<br>

#### ì˜ˆì™¸ ë°œìƒ íë¦„
`WAS(ì—¬ê¸°ê¹Œì§€ ì „íŒŒ) <- í•„í„° <- ì„œë¸”ë¦¿ <- ì¸í„°ì…‰í„° <- ì»¨íŠ¸ë¡¤ëŸ¬(ì˜ˆì™¸ë°œìƒ)`

<Br>

#### sendError íë¦„
`WAS(sendError í˜¸ì¶œ ê¸°ë¡ í™•ì¸) <- í•„í„° <- ì„œë¸”ë¦¿ <- ì¸í„°ì…‰í„° <- ì»¨íŠ¸ë¡¤ëŸ¬(response.sendError())`

<Br>

WASëŠ” í•´ë‹¹ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì˜¤ë¥˜ í˜ì´ì§€ ì •ë³´ë¥¼ í™•ì¸í•œë‹¤.

`new ErrorPage(RuntimeException.class, "/error-page/500")`

ì˜ˆë¥¼ ë“¤ì–´ì„œ RuntimeException ì˜ˆì™¸ê°€ WASê¹Œì§€ ì „ë‹¬ë˜ë©´, WASëŠ” ì˜¤ë¥˜ í˜ì´ì§€ ì •ë³´ë¥¼ í™•ì¸í•œë‹¤. 

í™•ì¸í•´ë³´ë‹ˆ RuntimeException ì˜ ì˜¤ë¥˜ í˜ì´ì§€ë¡œ /error-page/500 ì´ ì§€ì •ë˜ì–´ ìˆë‹¤.

WASëŠ” ì˜¤ë¥˜ í˜ì´ì§€ë¥¼ ì¶œë ¥í•˜ê¸° ìœ„í•´ /error-page/500 ë¥¼ ë‹¤ì‹œ ìš”ì²­í•œë‹¤.

<br>

#### ì˜¤ë¥˜ í˜ì´ì§€ ìš”ì²­ íë¦„

```
WAS `/error-page/500` ë‹¤ì‹œ ìš”ì²­ -> í•„í„° -> ì„œë¸”ë¦¿ -> ì¸í„°ì…‰í„° -> ì»¨íŠ¸ë¡¤ëŸ¬(/error-page/
500) -> View
```

<br>

#### ì˜ˆì™¸ ë°œìƒê³¼ ì˜¤ë¥˜ í˜ì´ì§€ ìš”ì²­ íë¦„

```
1. WAS(ì—¬ê¸°ê¹Œì§€ ì „íŒŒ) <- í•„í„° <- ì„œë¸”ë¦¿ <- ì¸í„°ì…‰í„° <- ì»¨íŠ¸ë¡¤ëŸ¬(ì˜ˆì™¸ë°œìƒ)
2. WAS `/error-page/500` ë‹¤ì‹œ ìš”ì²­ -> í•„í„° -> ì„œë¸”ë¦¿ -> ì¸í„°ì…‰í„° -> ì»¨íŠ¸ë¡¤ëŸ¬(/error-page/500) -> View
```

**ì¤‘ìš”í•œ ì ì€ ì›¹ ë¸Œë¼ìš°ì €(í´ë¼ì´ì–¸íŠ¸)ëŠ” ì„œë²„ ë‚´ë¶€ì—ì„œ ì´ëŸ° ì¼ì´ ì¼ì–´ë‚˜ëŠ”ì§€ ì „í˜€ ëª¨ë¥¸ë‹¤ëŠ” ì ì´ë‹¤. ì˜¤ì§ ì„œë²„ ë‚´ë¶€ì—ì„œ ì˜¤ë¥˜ í˜ì´ì§€ë¥¼ ì°¾ê¸° ìœ„í•´ ì¶”ê°€ì ì¸ í˜¸ì¶œì„ í•œë‹¤.**

<Br>


ì •ë¦¬í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.
1. ì˜ˆì™¸ê°€ ë°œìƒí•´ì„œ WASê¹Œì§€ ì „íŒŒëœë‹¤.
2. WASëŠ” ì˜¤ë¥˜ í˜ì´ì§€ ê²½ë¡œë¥¼ ì°¾ì•„ì„œ ë‚´ë¶€ì—ì„œ ì˜¤ë¥˜ í˜ì´ì§€ë¥¼ í˜¸ì¶œí•œë‹¤. ì´ë•Œ ì˜¤ë¥˜ í˜ì´ì§€ ê²½ë¡œë¡œ í•„í„°,  ì„œë¸”ë¦¿, ì¸í„°ì…‰í„°, ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ëª¨ë‘ ë‹¤ì‹œ í˜¸ì¶œëœë‹¤.

<br>

#### ì˜¤ë¥˜ ì •ë³´ ì¶”ê°€

WASëŠ” ì˜¤ë¥˜ í˜ì´ì§€ë¥¼ ë‹¨ìˆœíˆ ë‹¤ì‹œ ìš”ì²­ë§Œ í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì˜¤ë¥˜ ì •ë³´ë¥¼ request ì˜ attribute ì— ì¶”ê°€í•´ì„œ ë„˜ê²¨ì¤€ë‹¤.

í•„ìš”í•˜ë©´ ì˜¤ë¥˜ í˜ì´ì§€ì—ì„œ ì´ë ‡ê²Œ ì „ë‹¬ëœ ì˜¤ë¥˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤

<Br>

```
@Slf4j
@Controller
public class ErrorPageController {

    //RequestDispatcher ìƒìˆ˜ë¡œ ì •ì˜ë˜ì–´ ìˆìŒ
    public static final String ERROR_EXCEPTION = "javax.servlet.error.exception";
    public static final String ERROR_EXCEPTION_TYPE = "javax.servlet.error.exception_type";
    public static final String ERROR_MESSAGE = "javax.servlet.error.message";
    public static final String ERROR_REQUEST_URI = "javax.servlet.error.request_uri";
    public static final String ERROR_SERVLET_NAME = "javax.servlet.error.servlet_name";
    public static final String ERROR_STATUS_CODE = "javax.servlet.error.status_code";

    ...

    private void printErrorInfo(HttpServletRequest request){
        log.info("ERROR_EXCEPTION = {}",request.getAttribute(ERROR_EXCEPTION));
        log.info("ERROR_EXCEPTION_TYPE = {}",request.getAttribute(ERROR_EXCEPTION_TYPE));
        log.info("ERROR_MESSAGE = {}",request.getAttribute(ERROR_MESSAGE));
        log.info("ERROR_REQUEST_URI = {}",request.getAttribute(ERROR_REQUEST_URI));
        log.info("ERROR_SERVLET_NAME = {}",request.getAttribute(ERROR_SERVLET_NAME));
        log.info("ERROR_STATUS_CODE = {}",request.getAttribute(ERROR_STATUS_CODE));
        log.info("dispatchType = {}",request.getDispatcherType());
    }
}

```

<br><br>

### ì„œë¸”ë¦¿ ì˜ˆì™¸ ì²˜ë¦¬ - í•„í„°


ì˜ˆì™¸ ì²˜ë¦¬ì— ë”°ë¥¸ í•„í„°ì™€ ì¸í„°ì…‰í„° ê·¸ë¦¬ê³  ì„œë¸”ë¦¿ì´ ì œê³µí•˜ëŠ” DispatchType ì´í•´í•˜ê¸°

### ğŸ“Œ ì˜ˆì™¸ ë°œìƒê³¼ ì˜¤ë¥˜ í˜ì´ì§€ ìš”ì²­ íë¦„

```
1. WAS(ì—¬ê¸°ê¹Œì§€ ì „íŒŒ) <- í•„í„° <- ì„œë¸”ë¦¿ <- ì¸í„°ì…‰í„° <- ì»¨íŠ¸ë¡¤ëŸ¬(ì˜ˆì™¸ë°œìƒ)
2. WAS `/error-page/500` ë‹¤ì‹œ ìš”ì²­ -> í•„í„° -> ì„œë¸”ë¦¿ -> ì¸í„°ì…‰í„° -> ì»¨íŠ¸ë¡¤ëŸ¬(/error-page/500) -> View
```

<br>

ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ì˜¤ë¥˜ í˜ì´ì§€ë¥¼ ì¶œë ¥í•˜ê¸° ìœ„í•´ WAS ë‚´ë¶€ì—ì„œ ë‹¤ì‹œ í•œë²ˆ í˜¸ì¶œì´ ë°œìƒí•œë‹¤. ì´ë•Œ í•„í„°, ì„œë¸”ë¦¿, ì¸í„°ì…‰í„°ë„ ëª¨ë‘ ë‹¤ì‹œ í˜¸ì¶œëœë‹¤. 

ê·¸ëŸ°ë° ë¡œê·¸ì¸ ì¸ì¦ ì²´í¬ ê°™ì€ ê²½ìš°ë¥¼ ìƒê°í•´ë³´ë©´, ì´ë¯¸ í•œë²ˆ í•„í„°ë‚˜, ì¸í„°ì…‰í„°ì—ì„œ ë¡œê·¸ì¸ ì²´í¬ë¥¼ ì™„ë£Œí–ˆë‹¤. 
ë”°ë¼ì„œ ì„œë²„ ë‚´ë¶€ì—ì„œ ì˜¤ë¥˜ í˜ì´ì§€ë¥¼ í˜¸ì¶œí•œë‹¤ê³  í•´ì„œ í•´ë‹¹
í•„í„°ë‚˜ ì¸í„°ì…‰íŠ¸ê°€ í•œë²ˆ ë” í˜¸ì¶œë˜ëŠ” ê²ƒì€ ë§¤ìš° ë¹„íš¨ìœ¨ì ì´ë‹¤.


ê²°êµ­ í´ë¼ì´ì–¸íŠ¸ë¡œ ë¶€í„° ë°œìƒí•œ ì •ìƒ ìš”ì²­ì¸ì§€, ì•„ë‹ˆë©´ ì˜¤ë¥˜ í˜ì´ì§€ë¥¼ ì¶œë ¥í•˜ê¸° ìœ„í•œ ë‚´ë¶€ ìš”ì²­ì¸ì§€ êµ¬ë¶„í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.

ì„œë¸”ë¦¿ì€ ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ `DispatcherType` ì´ë¼ëŠ” ì¶”ê°€ ì •ë³´ë¥¼ ì œê³µí•œë‹¤.

<br><Br>

#### DispatcherType

í•„í„°ëŠ” ì´ëŸ° ê²½ìš°ë¥¼ ìœ„í•´ì„œ dispatcherTypes ë¼ëŠ” ì˜µì…˜ì„ ì œê³µí•œë‹¤.
ì´ì „ ê°•ì˜ì˜ ë§ˆì§€ë§‰ì— ë‹¤ìŒ ë¡œê·¸ë¥¼ ì¶”ê°€í–ˆë‹¤.

`log.info("dispatchType={}", request.getDispatcherType())`

ê·¸ë¦¬ê³  ì¶œë ¥í•´ë³´ë©´ ì˜¤ë¥˜ í˜ì´ì§€ì—ì„œ dispatchType=ERROR ë¡œ ë‚˜ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

<br>

ê³ ê°ì´ ì²˜ìŒ ìš”ì²­í•˜ë©´ `dispatcherType=REQUEST` ì´ë‹¤.

ì´ë ‡ë“¯ ì„œë¸”ë¦¿ ìŠ¤í™ì€ ì‹¤ì œ ê³ ê°ì´ ìš”ì²­í•œ ê²ƒì¸ì§€, ì„œë²„ê°€ ë‚´ë¶€ì—ì„œ ì˜¤ë¥˜ í˜ì´ì§€ë¥¼ ìš”ì²­í•˜ëŠ” ê²ƒì¸ì§€
DispatcherType ìœ¼ë¡œ êµ¬ë¶„í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí•œë‹¤.


```
âœ… javax.servlet.DispatcherType

public enum DispatcherType {
    FORWARD,
    INCLUDE,
    REQUEST,
    ASYNC,
    ERROR
}
```

- DispatcherType
    - REQUEST : í´ë¼ì´ì–¸íŠ¸ ìš”ì²­
    - ERROR : ì˜¤ë¥˜ ìš”ì²­
    - FORWARD : MVCì—ì„œ ë°°ì› ë˜ ì„œë¸”ë¦¿ì—ì„œ ë‹¤ë¥¸ ì„œë¸”ë¦¿ì´ë‚˜ JSPë¥¼ í˜¸ì¶œí•  ë•Œ
        - `RequestDispatcher.forward(request, response);`
    - INCLUDE : ì„œë¸”ë¦¿ì—ì„œ ë‹¤ë¥¸ ì„œë¸”ë¦¿ì´ë‚˜ JSPì˜ ê²°ê³¼ë¥¼ í¬í•¨í•  ë•Œ
        - `RequestDispatcher.include(request, response);`
    - ASYNC : ì„œë¸”ë¦¿ ë¹„ë™ê¸° í˜¸ì¶œ

<br>

#### í•„í„°ì™€ DispatcherType

í•„í„°ì™€ DispatcherTypeì´ ì–´ë–»ê²Œ ì‚¬ìš©ë˜ëŠ”ì§€ ì•Œì•„ë³´ì.

```
âœ… Log Filter 


@Slf4j
public class LogFilter implements Filter {
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        log.info("log filter init");
    }
    @Override
    public void doFilter(ServletRequest request, ServletResponse response,
                         FilterChain chain) throws IOException, ServletException {
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        String requestURI = httpRequest.getRequestURI();
        String uuid = UUID.randomUUID().toString();
        try {
            log.info("REQUEST [{}][{}][{}]", uuid,
                    request.getDispatcherType(), requestURI);
            chain.doFilter(request, response);
        } catch (Exception e) {
            throw e;
        } finally {
            log.info("RESPONSE [{}][{}][{}]", uuid,
                    request.getDispatcherType(), requestURI);
        }
    }
    @Override
    public void destroy() {
        log.info("log filter destroy");
    }
}


âœ… WebConfig


@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Bean
    public FilterRegistrationBean logFilter(){
        FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();

        filterRegistrationBean.setFilter(new LogFilter());
        filterRegistrationBean.setOrder(1);
        filterRegistrationBean.addUrlPatterns("/*");
        filterRegistrationBean.setDispatcherTypes(DispatcherType.REQUEST, DispatcherType.ERROR);
        return  filterRegistrationBean;
    }

}

```

<img width="557" alt="image" src="https://github.com/zeunxx/Inflearn-Spring-RoadMap/assets/81572478/bbfb5a91-e20d-43cb-ad8e-b21fbb34494b">

<br>

`filterRegistrationBean.setDispatcherTypes(DispatcherType.REQUEST,  DispatcherType.ERROR);`


ì´ë ‡ê²Œ ë‘ ê°€ì§€ë¥¼ ëª¨ë‘ ë„£ìœ¼ë©´ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì€ ë¬¼ë¡ ì´ê³ , ì˜¤ë¥˜ í˜ì´ì§€ ìš”ì²­ì—ì„œë„ í•„í„°ê°€ í˜¸ì¶œëœë‹¤.


ì•„ë¬´ê²ƒë„ ë„£ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ ê°’ì´ DispatcherType.REQUEST ì´ë‹¤. 

ì¦‰ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ í•„í„°ê°€ ì ìš©ëœë‹¤. íŠ¹ë³„íˆ ì˜¤ë¥˜ í˜ì´ì§€ ê²½ë¡œë„ í•„í„°ë¥¼ ì ìš©í•  ê²ƒì´ ì•„ë‹ˆë©´, ê¸°ë³¸ ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë©´ ëœë‹¤. 


ë¬¼ë¡  ì˜¤ë¥˜ í˜ì´ì§€ ìš”ì²­ ì „ìš© í•„í„°ë¥¼ ì ìš©í•˜ê³  ì‹¶ìœ¼ë©´ DispatcherType.ERROR ë§Œ ì§€ì •í•˜ë©´ ëœë‹¤.



<Br><br>

### ì„œë¸”ë¦¿ ì˜ˆì™¸ ì²˜ë¦¬ - ì¸í„°ì…‰í„°

ì¸í„°ì…‰í„° ì¤‘ë³µ í˜¸ì¶œ ì œê±°

<br>

```
@Slf4j
public class LogInterceptor implements HandlerInterceptor {
    public static final String LOG_ID = "logId";
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse
            response, Object handler) throws Exception {
        String requestURI = request.getRequestURI();
        String uuid = UUID.randomUUID().toString();
        request.setAttribute(LOG_ID, uuid);
        log.info("REQUEST [{}][{}][{}][{}]", uuid,
                request.getDispatcherType(), requestURI, handler);
        return true;
    }
    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse
            response, Object handler, ModelAndView modelAndView) throws Exception {
        log.info("postHandle [{}]", modelAndView);
    }
    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse
            response, Object handler, Exception ex) throws Exception {
        String requestURI = request.getRequestURI();
        String logId = (String)request.getAttribute(LOG_ID);
        log.info("RESPONSE [{}][{}][{}]", logId, request.getDispatcherType(),
                requestURI);
        if (ex != null) {
            log.error("afterCompletion error!!", ex);
        }
    }
}

```

ì•ì„œ í•„í„°ì˜ ê²½ìš°ì—ëŠ” í•„í„°ë¥¼ ë“±ë¡í•  ë•Œ ì–´ë–¤ DispatcherType ì¸ ê²½ìš°ì— í•„í„°ë¥¼ ì ìš©í•  ì§€ ì„ íƒí•  ìˆ˜
ìˆì—ˆë‹¤. ê·¸ëŸ°ë° ì¸í„°ì…‰í„°ëŠ” ì„œë¸”ë¦¿ì´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì´ ì•„ë‹ˆë¼ ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤. ë”°ë¼ì„œ
DispatcherType ê³¼ ë¬´ê´€í•˜ê²Œ í•­ìƒ í˜¸ì¶œëœë‹¤.


ëŒ€ì‹ ì— ì¸í„°ì…‰í„°ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ìš”ì²­ ê²½ë¡œì— ë”°ë¼ì„œ ì¶”ê°€í•˜ê±°ë‚˜ ì œì™¸í•˜ê¸° ì‰½ê²Œ ë˜ì–´ ìˆê¸° ë•Œë¬¸ì—, ì´ëŸ¬í•œ
ì„¤ì •ì„ ì‚¬ìš©í•´ì„œ ì˜¤ë¥˜ í˜ì´ì§€ ê²½ë¡œë¥¼ excludePathPatterns ë¥¼ ì‚¬ìš©í•´ì„œ ë¹¼ì£¼ë©´ ëœë‹¤

```
@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new LogInterceptor())
                .order(1)
                .addPathPatterns("/**")
                .excludePathPatterns("/css/**","*.ico","/error", "/error-page/**"); //ì˜¤ë¥˜í˜ì´ì§€ ê²½ë¡œ ì¶”ê°€
    }
    ...
}
```

ì—¬ê¸°ì—ì„œ /error-page/** ë¥¼ ì œê±°í•˜ë©´ error-page/500 ê°™ì€ ë‚´ë¶€ í˜¸ì¶œì˜ ê²½ìš°ì—ë„ ì¸í„°ì…‰í„°ê°€
í˜¸ì¶œëœë‹¤.

<br><Br>

### ì „ì²´ íë¦„ ì •ë¦¬

#### `/hello` ì •ìƒ ìš”ì²­

```
WAS(/hello, dispatchType=REQUEST) -> í•„í„° -> ì„œë¸”ë¦¿ -> ì¸í„°ì…‰í„° -> ì»¨íŠ¸ë¡¤ëŸ¬ -> View
```

<br>

#### `/error-ex` ì˜¤ë¥˜ ìš”ì²­

- í•„í„°ëŠ” DispatchType ìœ¼ë¡œ ì¤‘ë³µ í˜¸ì¶œ ì œê±° ( dispatchType=REQUEST )
- ì¸í„°ì…‰í„°ëŠ” ê²½ë¡œ ì •ë³´ë¡œ ì¤‘ë³µ í˜¸ì¶œ ì œê±°( excludePathPatterns("/error-page/**") )

```
1. WAS(/error-ex, dispatchType=REQUEST) -> í•„í„° -> ì„œë¸”ë¦¿ -> ì¸í„°ì…‰í„° -> ì»¨íŠ¸ë¡¤ëŸ¬
2. WAS(ì—¬ê¸°ê¹Œì§€ ì „íŒŒ) <- í•„í„° <- ì„œë¸”ë¦¿ <- ì¸í„°ì…‰í„° <- ì»¨íŠ¸ë¡¤ëŸ¬(ì˜ˆì™¸ë°œìƒ)
3. WAS ì˜¤ë¥˜ í˜ì´ì§€ í™•ì¸
4. WAS(/error-page/500, dispatchType=ERROR) -> í•„í„°(x) -> ì„œë¸”ë¦¿ -> ì¸í„°ì…‰í„°(x) -> ì»¨íŠ¸ë¡¤ëŸ¬(/error-page/500) -> View
```

<br>