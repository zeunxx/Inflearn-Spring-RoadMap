# HTTP ν—¤λ” 2 - μΊμ‹μ™€ μ΅°κ±΄λ¶€ μ”μ²­

## μΊμ‹ κΈ°λ³Έ λ“±μ‘

<BR>
<img width="600" alt="image" src="https://user-images.githubusercontent.com/81572478/192253726-3daa880f-40a2-4c13-8387-2b9f910ce644.png">
<img width="594" alt="image" src="https://user-images.githubusercontent.com/81572478/192253823-6e1a78e7-2c99-4575-a5f6-6e69d8e0b059.png">


- μΊμ‹κ°€ μ—†μ„ λ•

    - λ°μ΄ν„°κ°€ λ³€κ²½λμ§€ μ•μ•„λ„ κ³„μ† λ„¤νΈμ›ν¬λ¥Ό ν†µν•΄ λ°μ΄ν„°λ¥Ό λ‹¤μ΄λ΅λ“ λ°›μ•„μ•Ό ν•¨
    - μΈν„°λ„· λ„¤νΈμ›ν¬λ” λ§¤μ° λλ¦¬κ³  λΉ„μ
    - λΈλΌμ°μ € λ΅λ”© μ†λ„κ°€ λλ¦Ό
    - λλ¦° μ‚¬μ©μ κ²½ν— 

<BR><BR>

<img width="590" alt="image" src="https://user-images.githubusercontent.com/81572478/192254095-a10a67b9-59d4-4451-868b-029c582da5d2.png">
<img width="593" alt="image" src="https://user-images.githubusercontent.com/81572478/192254191-1748548d-5d80-4174-b704-bfc02df4018a.png">
<img width="590" alt="image" src="https://user-images.githubusercontent.com/81572478/192254266-ae417529-28c1-4767-8a5a-05df1bdcfcb6.png">

- μΊμ‹ μ μ©
    - μΊμ‹ λ•λ¶„μ— κ°€λ¥ μ‹κ°„λ™μ• λ„¤νΈμ›ν¬ μ‚¬μ©ν•μ§€ μ•μ•„λ„ λ¨
    - λΉ„μ‹Ό λ„¤νΈμ›ν¬ μ‚¬μ©λ‰ μ¤„μ„
    - λΈλΌμ°μ € λ΅λ”© μ†λ„κ°€ λ§¤μ° λΉ λ¦„
    - λΉ λ¥Έ μ‚¬μ©μ κ²½ν—

<bR>

<img width="602" alt="image" src="https://user-images.githubusercontent.com/81572478/192254500-4898002c-d5a1-43e7-99c3-3f9556469ef1.png">
: μ‹κ°„ μ΄κ³Όλλ©΄ λ‹¤μ‹ μ”μ²­ν•΄μ•Όν•¨

- μ„λ²„λ¥Ό ν†µν•΄ λ°μ΄ν„°λ¥Ό λ‹¤μ‹ μ΅°νν•κ³ , μΊμ‹λ¥Ό κ°±μ‹ , μ΄λ• λ‹¤μ‹ λ„¤νΈμ›ν¬ λ‹¤μ΄λ΅λ“κ°€ λ°μƒν•λ‹¤

<BR><bR>

π” μΊμ‹κ°€ λ§λ£λμ—λ”λ°, μ„λ²„κ°€ κ°€μ§„ λ°μ΄ν„°μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ κ°€μ§„ λ°μ΄ν„°κ°€ λ™μΌν•λ‹¤λ©΄ κµ³μ΄ λ‹¤μ΄ λ°›μ•„μ•Ό ν• κΉ?

<BR>

## κ²€μ¦ ν—¤λ”μ™€ μ΅°κ±΄λ¶€ μ”μ²­

### μΊμ‹ μ‹κ°„ μ΄κ³Ό
:  μΊμ‹ μ ν¨ μ‹κ°„μ΄ μ΄κ³Όν•΄μ„ μ„λ²„μ— λ‹¤μ‹ μ”μ²­ν•λ©΄ 
<img width="432" alt="image" src="https://user-images.githubusercontent.com/81572478/192255082-f17d5ea5-3c4d-4cdc-89b0-ba003e2f220a.png">

<BR>

μΊμ‹ λ§λ£ ν›„μ—λ„ μ„λ²„μ—μ„ λ°μ΄ν„°λ¥Ό λ³€κ²½ν•μ§€ μ•μ•λ‹¤λ©΄, λ°μ΄ν„°λ¥Ό μ „μ†΅ν•λ” λ€μ‹  μ €μ¥ν•΄λ‘μ—λ μΊμ‹λ¥Ό μ¬μ‚¬μ©!
λ‹¨, ν΄λΌμ΄μ–ΈνΈμ λ°μ΄ν„°μ™€ μ„λ²„μ λ°μ΄ν„°κ°€ κ°™λ‹¤λ” μ‚¬μ‹¤μ„ ν™•μΈν•  λ°©λ²•μ΄ ν•„μ”!!

<BR>

### κ²€μ¦ ν—¤λ” μ¶”κ°€

<img width="613" alt="image" src="https://user-images.githubusercontent.com/81572478/192256716-6ecd224a-9925-42d6-b534-d52e027406ed.png">
<img width="608" alt="image" src="https://user-images.githubusercontent.com/81572478/192256863-e98a9fbc-c8c3-4af6-88a4-575b4d1c580a.png">
: μµμΆ… μμ •μΌλ„ μΊμ‹μ— μ €μ¥

<img width="557" alt="image" src="https://user-images.githubusercontent.com/81572478/192257004-ab72251e-f000-4ea1-aea0-9b942225bd75.png">
: μ΅°κ±΄λ¶€ μ”μ²­(if-modified-since: λ‚ μ§)

π” μ΄λ• μ΄ν›„λ΅ λ°μ΄ν„°κ°€ λ°”λ€μ—λ”μ§€? 

- μ•λ°”λ€λ©΄ 304 μ‘λ‹µ

- λ°”λ€λ©΄ λ‹¤μ‹ λ‹¤μ΄λ΅λ“

<img width="559" alt="image" src="https://user-images.githubusercontent.com/81572478/192257080-b34a9eff-1963-46e8-ba95-23ed686744f6.png">
: μ„λ²„μ—μ„ ν΄λΌμ΄μ–ΈνΈμ μΊμ‹μ— μλ λ°μ΄ν„°λ¥Ό κ²€μ¦ν•¨

<img width="571" alt="image" src="https://user-images.githubusercontent.com/81572478/192257319-0dc80082-b325-410c-b17a-7d14de30c97b.png">
<img width="644" alt="image" src="https://user-images.githubusercontent.com/81572478/192257421-8631b8c8-1570-4e48-a8d1-fce4108e556f.png">
: HTTP ν—¤λ”λ§ μ „μ†΅(κΈ°μ΅΄λ³΄λ‹¤ λ„¤νΈμ›ν¬ λ¶€ν™” μ¤„κ²λ¨)

<img width="645" alt="image" src="https://user-images.githubusercontent.com/81572478/192257571-79f2883b-d02e-43bc-8cef-a877217312a4.png">
: μΊμ‹ μ¬μ‚¬μ©

<br>

- μΊμ‹ μ ν¨ μ‹κ°„μ΄ μ΄κ³Όν•΄λ„, μ„λ²„μ λ°μ΄ν„°κ°€ κ°±μ‹ λμ§€ μ•μΌλ©΄
- 304 Not Modified + ν—¤λ” λ©”νƒ€ μ •λ³΄λ§ μ‘λ‹µ(λ°”λ”” x)
- ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„κ°€ λ³΄λ‚Έ μ‘λ‹µ ν—¤λ” μ •λ³΄λ΅ μΊμ‹μ λ©”νƒ€ μ •λ³΄ κ°±μ‹ 
- ν΄λΌμ΄μ–ΈνΈλ” μΊμ‹μ— μ €μ¥λμ–΄ μλ λ°μ΄ν„° μ¬ν™μ©
- κ²°κ³Όμ μΌλ΅ λ„¤νΈμ›ν¬ λ‹¤μ΄λ΅λ“ λ°μƒν•μ§€λ§ μ©λ‰μ΄ μ μ€ ν—¤λ” μ •λ³΄λ§ λ‹¤μ΄λ΅λ“


<Br><Br>

### κ²€μ¦ ν—¤λ”
: μΊμ‹ λ°μ΄ν„°μ™€ μ„λ²„ λ°μ΄ν„°κ°€ κ°™μ€μ§€ κ²€μ¦ν•λ” λ°μ΄ν„°
- Last-Modified, ETag

### μ΅°κ±΄λ¶€ μ”μ²­ ν—¤λ”

: κ²€μ¦ν—¤λ”λ΅ μ΅°κ±΄μ— λ”°λ¥Έ λ¶„κΈ°
- If-Modified-Since: Last-Modified μ‚¬μ©
- If-None-Match: ETag μ‚¬μ©
    - μ΅°κ±΄μ΄ λ§μ΅±ν•λ©΄ 200 OK
    - μ΅°κ±΄ λ§μ΅±ν•μ§€ μ•μΌλ©΄ 304 Not Modified


#### 1οΈβƒ£ If-Modified-Since: μ΄ν›„μ— λ°μ΄ν„°κ°€ μμ •λμ—μΌλ©΄?

- λ°μ΄ν„° λ―Έλ³€κ²½ μμ‹
    - μΊμ‹: 2020λ…„ 11μ›” 10μΌ 10:00:00 vs μ„λ²„: 2020λ…„ 11μ›” 10μΌ 10:00:00
    - **304 Not Modified**(λ¦¬λ‹¤μ΄λ ‰μ…: μΊμ‹λ΅ λ¦¬λ‹¤μ΄λ ‰μ…ν•¨!), ν—¤λ” λ°μ΄ν„°λ§ μ „μ†΅(body λ―Έν¬ν•¨)
    - μ „μ†΅μ©λ‰ 0.1M(ν—¤λ” 0.1M, λ°”λ”” 1.0M)

- λ°μ΄ν„° λ³€κ²½ μμ‹
     - μΊμ‹: 2020λ…„ 11μ›” 10μΌ 10:00:00 vs μ„λ²„: 2020λ…„ 11μ›” 10μΌ **11**:00:00
    - **200 OK**, λ¨λ“  λ°μ΄ν„° μ „μ†΅(body ν¬ν•¨)
    - μ „μ†΅μ©λ‰ 1.1M(ν—¤λ” 0.1M, λ°”λ”” 1.0M)


#### π“ λ‹¨μ 

- 1μ΄ λ―Έλ§ λ‹¨μ„λ΅ μΊμ‹ μ΅°μ • λ¶κ°€λ¥
- λ‚ μ§ κΈ°λ°μ λ΅μ§ μ‚¬μ©
- λ°μ΄ν„°λ¥Ό μμ •ν•΄μ„ λ‚ μ§κ°€ λ‹¤λ¥΄μ§€λ§, κ°™μ€ λ°μ΄ν„°λ¥Ό μμ •ν•΄μ„ λ°μ΄ν„° κ²°κ³Όκ°€ λ‘κ°™μ€ κ²½μ°: κ°™μ€ λ°μ΄ν„°λ¥Ό λ°›λ”λ° λ‚ μ§κ°€ κ°±μ‹ λμ–΄ λ‹¤μ‹ λ‹¤μ΄λ¨
- μ„λ²„μ—μ„ λ³„λ„μ μΊμ‹ λ΅μ§ κ΄€λ¦¬ν•κ³  μ‹¶μ€ κ²½μ°
    ex) μ¤νμ΄μ¤/μ£Όμ„μ²λΌ ν¬κ² μν–¥ μ—†λ” λ³€κ²½μ—μ„ μΊμ‹ μ μ§€ν•κ³  μ‹¶μ€ κ²½μ°

<br>

#### 2οΈβƒ£ ETag(Entity Tag)
- μΊμ‹μ© λ°μ΄ν„°μ— μ„μμ κ³ μ ν• λ²„μ „ μ΄λ¦„ λ‹¬μ•„λ‘ 
- λ°μ΄ν„°κ°€ λ³€κ²½λλ©΄ μ΄λ¦„μ„ λ°”κΎΈμ–΄μ„ λ³€κ²½(Hash λ‹¤μ‹ μƒμ„±)
    ex) ETag: "aaaaa" β†’ ETag: "bbbbb"

- λ‹¨μν•κ² ETagλ§ λ³΄λ‚΄μ„ κ°™μΌλ©΄ μ μ§€, λ‹¤λ¥΄λ©΄ λ‹¤μ‹ λ°›κΈ°

<br>

<img width="607" alt="image" src="https://user-images.githubusercontent.com/81572478/192260337-7cdaceb8-b086-4379-981b-79e593a8323d.png">
<img width="601" alt="image" src="https://user-images.githubusercontent.com/81572478/192260407-220e22b4-d225-4cbb-a36c-f1e57ddb377f.png">
<img width="572" alt="image" src="https://user-images.githubusercontent.com/81572478/192260476-79a5c1ba-a99c-44fb-9c64-eae9d720aaa8.png">
<img width="549" alt="image" src="https://user-images.githubusercontent.com/81572478/192260587-ad473dcc-4d9e-48b6-8d42-f3dd849d89e3.png">
<img width="650" alt="image" src="https://user-images.githubusercontent.com/81572478/192260623-7dd330fc-767b-4e03-bc93-7487166b491a.png">
<img width="645" alt="image" src="https://user-images.githubusercontent.com/81572478/192260692-1228875b-cb3d-4f59-89cd-b10bc3de0943.png">


<br>

- λ‹¨μν•κ² μ„λ²„μ— ETagλ§ λ³΄λ‚΄μ„ κ°™μΌλ©΄ μ μ§€, λ‹¤λ¥΄λ©΄ λ‹¤μ‹ λ°›κΈ° 
- **μΊμ‹ μ μ–΄ λ΅μ§μ„ μ„λ²„μ—μ„ μ™„μ „ν κ΄€λ¦¬**
- ν΄λΌμ΄μ–ΈνΈλ” λ‹¨μν μ΄ κ°’μ„ μ„λ²„μ— μ κ³µ(ν΄λΌμ΄μ–ΈνΈλ” μΊμ‹ λ©”μ»¤λ‹μ¦ λ¨λ¦„)

    ex) μ„λ²„λ” λ°°νƒ€ μ¤ν” κΈ°κ°„μΈ 3μΌλ™μ• νμΌμ΄ λ³€κ²½λμ–΄λ„ ETag λ™μΌν•κ² μ μ§€
    
    μ• ν”λ¦¬μΌ€μ΄μ… λ°°ν¬μ£ΌκΈ°μ— λ§μ¶”μ–΄ ETag λ¨λ‘ κ°±μ‹ 


<br><br>

### μΊμ‹ μ μ–΄ ν—¤λ”

- Cache-Control : μΊμ‹ μ μ–΄
    - max-age: μΊμ‹ μ ν¨ μ‹κ°„, μ΄λ‹¨μ„
    - no-cache: λ°μ΄ν„°λ” μΊμ‹ν•΄λ„ λμ§€λ§, ν•­μƒ origin(μ›) μ„λ²„μ— κ²€μ¦ν•κ³  μ‚¬μ©
    - no-store : λ°μ΄ν„°μ— λ―Όκ°ν• μ •λ³΄ μμΌλ©΄ μ•λ¨(μ•„μ μ €μ¥x, μμΌλ©΄ λΉ¨λ¦¬ μ‚­μ )


- Pragma : μΊμ‹ μ μ–΄(ν•μ„ νΈν™)

- Expires : μΊμ‹ μ ν¨ κΈ°κ°„(ν•μ„ νΈν™)
    - μΊμ‹ λ§λ£μΌμ„ μ •ν™•ν• λ‚ μ§λ΅ μ§€μ •(but λ” μ μ—°ν• max-ageκ¶μ¥)
    - Cache-Control:max-ageμ™€ ν•¨κ» μ‚¬μ©ν•λ©΄ Expiresλ” λ¬΄μ‹


<br><Br>

## ν”„λ΅μ‹ μΊμ‹



<img width="587" alt="image" src="https://user-images.githubusercontent.com/81572478/192264390-ea976fc4-461c-4d6f-894b-769d37c79765.png">
: μ‘λ‹µ λλ¦Ό

<br>

<img width="644" alt="image" src="https://user-images.githubusercontent.com/81572478/192265049-b0cdd0f3-24ed-4eaf-9a39-261503697f79.png">

: μ”μ²­μ΄ μ¤λ©΄ μ›μ„λ²„μ— λ°”λ΅ κ°€λ”κ² μ•„λ‹λΌ ν”„λ΅μ‹ μ„λ²„μ— λ¨Όμ € μ ‘κ·Όν•κ² λ¨

ex) μ νλΈμ—μ„ μ™Έκµ­μ μΈκΈ° μ—†λ” μ»¨ν…μΈ λ” λ‹¤μ΄μ΄ λλ¦¬μ§€λ§ μΈκΈ° λ§μ€ μ»¨ν…μΈ λ” λ‹¤μ΄ λΉ λ¦„(ν•κµ­μ— ν”„λ΅μ‹ μΊμ‹ μ„λ²„κ°€ μμ–΄μ„..)

<BR>

### Cache-Control

- Cache-Control: public
    - μ‘λ‹µμ΄ public μΊμ‹μ— μ €μ¥λμ–΄λ„ λ¨

- Cache-Control: private
- μ‘λ‹µμ΄ ν•΄λ‹Ή μ‚¬μ©μλ§μ„ μ„ν• κ²ƒ, private μΊμ‹μ— μ €μ¥λμ–΄μ•Ό ν•¨

- Cache-Control: s-maxage
    -  ν”„λ΅μ‹ μΊμ‹μ—λ§ μ μ©λλ” max age

- Age:60(HTTP ν—¤λ”)
    - μ¤λ¦¬μ§„ μ„λ²„μ—μ„ μ‘λ‹µ ν›„ ν”„λ΅μ‹ μΊμ‹ λ‚΄μ— λ¨Έλ¬Έ μ‹κ°„(μ΄)

#### β• Origin server : μ§„μ§ μμ›κ³Ό λ¦¬μ†μ¤κ°€ μλ” μ„λ²„

<BR><br>

## μΊμ‹ λ¬΄ν¨ν™”

### ν™•μ‹¤ν• μΊμ‹ λ¬΄ν¨ν™” μ‘λ‹µ
: μΊμ‹κ°€ μ λ€λ΅ λλ©΄ μ•λ λ• λ„£μ–΄ μ£Όλ©΄ λ¨

- Cache-Control: no-cache, no-store, must-revalidate

    - no-cache: λ°μ΄ν„°λ” μΊμ‹ν•΄λ„ λμ§€λ§, ν•­μƒ μ› μ„λ²„μ— κ²€μ¦ν•κ³  μ‚¬μ©
    - no-store: λ°μ΄ν„°μ— λ―Όκ°ν• μ •λ³΄κ°€ μμΌλ―€λ΅ μ €μ¥ν•λ©΄ μ•λ¨(λ©”λ¨λ¦¬μ—μ„ μ‚¬μ©ν•κ³  μµλ€ν• λΉ¨λ¦¬ μ‚­μ )
    - must-revalidate: μΊμ‹ λ§λ£ ν›„ μµμ΄ μ΅°νμ‹ **μ› μ„λ²„**μ— κ²€μ¦ν•΄ν–μ•”
    
        μ› μ„λ²„ μ ‘κ·Ό μ‹¤ν¨μ‹ λ°λ“μ‹ μ¤λ¥κ°€ λ°μƒν•΄μ•Ό ν•¨(504 Gateway Timeout)

        must-revalidateλ” μΊμ‹ μ ν¨ μ‹κ°„μ΄λΌλ©΄ μΊμ‹λ¥Ό μ‚¬μ©ν•¨



- Pragma: no-cache(HTTP 1.0 ν•μ„ νΈν™)

<br>

### β… no cache

<img width="631" alt="image" src="https://user-images.githubusercontent.com/81572478/192266448-4752ea1a-1108-4154-8fc6-2cb0d5e9292e.png">
: no-cacheλ” μ›μ„λ²„μ— κ²€μ¦ μ”μ²­!

<br>

<img width="636" alt="image" src="https://user-images.githubusercontent.com/81572478/192266578-d1f0f417-93ed-439d-949c-61fcc9c0313e.png">

: μ› μ„λ²„μ— κ²€μ¦λ°›μΌλ ¤ ν•λ”λ° λ„¤νΈμ›ν¬ λ‹¤μ΄,
μ¤λ¥ λ€μ‹  μ¤λλ λ°μ΄ν„°λ΅ λ³΄μ—¬μ¤„ μ μμ(200 OK)

<br>

### β… must revalidate
<img width="626" alt="image" src="https://user-images.githubusercontent.com/81572478/192266900-80b58fa8-718c-41f2-834e-54e682f3c044.png">
: μ› μ„λ²„μ— κ²€μ¦λ°›μΌλ ¤ ν•λ”λ° λ„¤νΈμ›ν¬ λ‹¤μ΄,
λ¬΄μ΅°κ±΄ 504 Timeout λ•λ¦Ό