## ì£¼ë¬¸ ì¡°íšŒ(OneToMany ê´€ê³„ ì¡°íšŒ)

### ì£¼ë¬¸ ì¡°íšŒ V1 : ì—”í‹°í‹° ì§ì ‘ ë…¸ì¶œ

```
    @GetMapping("/api/v1/orders")
    public List<Order> orderV1() {
        List<Order> all = orderRepository.findAllByCriteria(new OrderSearch());
        for (Order order : all) {
            order.getMember().getName();
            order.getDelivery().getAddress();

            List<OrderItem> orderItems = order.getOrderItems();
            orderItems.forEach(orderItem -> orderItem.getItem().getName());
        }
        return  all;
    }
```
- orderItem , item ê´€ê³„ë¥¼ ì§ì ‘ ì´ˆê¸°í™”í•˜ë©´ Hibernate5Module ì„¤ì •ì— ì˜í•´ ì—”í‹°í‹°ë¥¼ JSONìœ¼ë¡œ
ìƒì„±

- ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë©´ ë¬´í•œ ë£¨í”„ì— ê±¸ë¦¬ì§€ ì•Šê²Œ í•œê³³ì— @JsonIgnore ë¥¼ ì¶”ê°€í•´ì•¼ í•¨

- ì—”í‹°í‹°ë¥¼ ì§ì ‘ ë…¸ì¶œí•˜ë¯€ë¡œ ì¢‹ì€ ë°©ë²•ì´ ì•„ë‹˜

<br><Br>

### ì£¼ë¬¸ ì¡°íšŒ V2 : ì—”í‹°í‹°ë¥¼ DTOë¡œ ë³€í™˜

```
    @GetMapping("/api/v2/orders")
    public List<OrderDto> orderV2() {
        List<Order> orders = orderRepository.findAllByCriteria(new OrderSearch());
        return orders.stream()
                .map(o -> new OrderDto(o))
                .collect(Collectors.toList());
    }

    @Data
    static class OrderDto{
        private Long orderId;
        private String name;
        private LocalDateTime orderDate;
        private OrderStatus orderStatus;
        private Address address;
        private List<OrderItemDto> orderItems; // orderItemë„ DTOë¡œ ë³€í™˜ í›„ ë¦¬í„´!

        public OrderDto(Order o) {
            this.orderId = o.getId();
            this.name = o.getMember().getName();
            this.orderDate = o.getOrderDate();
            this.orderStatus = o.getStatus();
            this.address = o.getDelivery().getAddress();
            this.orderItems = o.getOrderItems().stream()    // orderItemë„ ì—”í‹°í‹°ë¡œ ë¦¬í„´ x(dtoë¡œ ë³€í™˜)
                    .map(orderItem -> new OrderItemDto(orderItem))
                    .collect(Collectors.toList());
        }
    }

    @Data
    static class OrderItemDto{
        private String itemName;
        private int orderPrice;
        private int count;
        public OrderItemDto(OrderItem orderItem) {
            itemName = orderItem.getItem().getName();
            orderPrice = orderItem.getOrderPrice();
            count = orderItem.getCount();
        }
    }
```
- ì§€ì—°ë¡œë”©ìœ¼ë¡œ ë„ˆë¬´ ë§ì€ SQL ì‹¤í–‰ë¨
- SQL ì‹¤í–‰ ìˆ˜
    - order 1ë²ˆ
    - member, address Në²ˆ(order ì¡°íšŒ ìˆ˜ ë§Œí¼)
    - orderItem Në²ˆ(order ì¡°íšŒ ìˆ˜ ë§Œí¼)
    - item(orderItem ì¡°íšŒ ìˆ˜ ë§Œí¼)

> ì°¸ê³ : ì§€ì—°ë¡œë”©ì€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ìˆìœ¼ë©´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ìˆëŠ” ì—”í‹°í‹°ë¥¼ ì‚¬ìš©í•˜ê³ , ì—†ìœ¼ë©´ SQL ì‹¤í–‰. ë”°ë¼ì„œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì´ë¯¸ ë¡œë”©ëœ íšŒì›ì—”í‹°í‹°ë¥¼ ì¶”ê°€ë¡œ ì¡°íšŒí•˜ë©´ SQL ì‹¤í–‰ X

<BR><bR>

### ì£¼ë¬¸ ì¡°íšŒ V3: ì—”í‹°í‹°ë¥¼ DTOë¡œ ë³€í™˜ - í˜ì¹˜ ì¡°ì¸ ìµœì í™”

```
    @GetMapping("/api/v3/orders")
    public List<OrderDto> orderV3() {
        List<Order> orders = orderRepository.findAllWithItem(); // ë°ì´í„° ë»¥íŠ€ê¸° ë¨
        return orders.stream()
                .map(o -> new OrderDto(o))
                .collect(Collectors.toList());
    }

    âœ… OrderRepository - ì¶”ê°€ ì½”ë“œ

    public List<Order> findAllWithItem() {
        return em.createQuery(
                "select distinct o from Order o" +
                        " join fetch o.member m" +
                        " join fetch o.delivery" +
                        " join fetch o.orderItems oi" +
                        " join fetch oi.item i", Order.class
        ).
                getResultList();
    }

```
- fetch joinìœ¼ë¡œ SQLì´ 1ë²ˆë§Œ ì‹¤í–‰ë¨
- distinctë¥¼ ì‚¬ìš©í•œ ì´ìœ ëŠ” 1ëŒ€ë‹¤ ì¡°ì¸ì´ ìˆìœ¼ë¯€ë¡œ ë°ì´í„°ë² ì´ìŠ¤ ROWê°€ ì¦ê°€. ê·¸ ê²°ê³¼ ê°™ì€ order ì—”í‹°í‹°ì˜ ì¡°íšŒìˆ˜ë„ ì¦ê°€í•¨. JPAì˜ distinctëŠ” SQLì— distinctë¥¼ ì¶”ê°€í•˜ê³ , ë”í•´ì„œ ê°™ì€ ì—”í‹°í‹°ê°€ ì¡°íšŒë˜ë©´, ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì¤‘ë³µ ê±¸ëŸ¬ ì¤Œ
    - ì´ ì˜ˆì—ì„œ orderê°€ ì»¬ë ‰ì…˜ í˜ì¹˜ì¡°ì¸ë•Œë¬¸ì— ì¤‘ë³µ ì¡°íšŒë˜ëŠ” ê²ƒì„ ë§‰ì•„ì¤Œ
- ë‹¨ì : **í˜ì´ì§• ë¶ˆê°€ëŠ¥** (1ëŒ€ë‹¤ í˜ì¹˜ì¡°ì¸ ì‚¬ìš©ì‹œ!)

<br>

> ì°¸ê³ : ì»¬ë ‰ì…˜ í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•˜ë©´ í˜ì´ì§•ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤. í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” ê²½ê³  ë¡œê·¸ë¥¼ ë‚¨ê¸°ë©´ì„œ ëª¨ë“ 
ë°ì´í„°ë¥¼ DBì—ì„œ ì½ì–´ì˜¤ê³ , ë©”ëª¨ë¦¬ì—ì„œ í˜ì´ì§• í•´ë²„ë¦°ë‹¤(ë§¤ìš° ìœ„í—˜í•˜ë‹¤). ìì„¸í•œ ë‚´ìš©ì€ ìë°” ORM í‘œì¤€
JPA í”„ë¡œê·¸ë˜ë°ì˜ í˜ì¹˜ ì¡°ì¸ ë¶€ë¶„ì„ ì°¸ê³ í•˜ì.


> ì°¸ê³ : ì»¬ë ‰ì…˜ í˜ì¹˜ ì¡°ì¸ì€ 1ê°œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì»¬ë ‰ì…˜ ë‘˜ ì´ìƒì— í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•˜ë©´ ì•ˆëœë‹¤. ë°ì´í„°ê°€
ë¶€ì •í•©í•˜ê²Œ ì¡°íšŒë  ìˆ˜ ìˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë°ì„ ì°¸ê³ í•˜ì.

<br><br>

### ì£¼ë¬¸ ì¡°íšŒ V3.1 : ì—”í‹°í‹°ë¥¼ DTOë¡œ ë³€í™˜ - í˜ì´ì§•ê³¼ í•œê³„ ëŒíŒŒ

#### âœ… í˜ì´ì§•ê³¼ í•œê³„ ëŒíŒŒ
- ì»¬ë ‰ì…˜ì„ í˜ì¹˜ ì¡°ì¸í•˜ë©´ í˜ì´ì§•ì´ ë¶ˆê°€ëŠ¥!
    - ì»¬ë ‰ì…˜ì„ í˜ì¹˜ ì¡°ì¸í•˜ë©´ ì¼ëŒ€ë‹¤ ì¡°ì¸ì´ ë°œìƒí•˜ë¯€ë¡œ ë°ì´í„°ê°€ ì˜ˆì¸¡í•  ìˆ˜ ì—†ì´ ì¦ê°€
    - ì¼ëŒ€ë‹¤ì—ì„œ ì¼(1)ì„ ê¸°ì¤€ìœ¼ë¡œ í˜ì´ì§•ì„ í•˜ëŠ”ê²ƒì´ ëª©ì ì´ì§€ë§Œ, ë°ì´í„°ëŠ” ë‹¤(N)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ rowê°€ ìƒì„±ë¨
    - Orderë¥¼ ê¸°ì¤€ìœ¼ë¡œ í˜ì´ì§• í•˜ê³  ì‹¶ì€ë°, ë‹¤(N)ì¸ OrderItemì„ ì¡°ì¸í•˜ë©´ OrderItemì´ ê¸°ì¤€ì´ ë¼ë²„ë¦¼
- ì´ ê²½ìš° í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” ê²½ê³  ë¡œê·¸ë¥¼ ë‚¨ê¸°ê³  ëª¨ë“  DB ë°ì´í„°ë¥¼ ì½ì–´ì„œ ë©”ëª¨ë¦¬ì—ì„œ í˜ì´ì§• ì‹œë„ 

    â¡ï¸ ìµœì•…ì˜ ê²½ìš° ì¥ì• ë¡œ ì´ì–´ì§

<BR>

#### ğŸ’¡ í•œê³„ ëŒíŒŒ

ê·¸ëŸ¬ë©´ í˜ì´ì§• + ì»¬ë ‰ì…˜ ì—”í‹°í‹°ë¥¼ í•¨ê»˜ ì¡°íšŒí•˜ë ¤ë©´?

- ë¨¼ì € ToOne(OneToOne, ManyToOne) ê´€ê³„ë¥¼ ëª¨ë‘ í˜ì¹˜ì¡°ì¸ í•¨! ToOne ê´€ê³„ëŠ” rowìˆ˜ë¥¼
ì¦ê°€ì‹œí‚¤ì§€ ì•Šìœ¼ë¯€ë¡œ í˜ì´ì§• ì¿¼ë¦¬ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŒ
- ì»¬ë ‰ì…˜ì€ ì§€ì—°ë¡œë”©ìœ¼ë¡œ ì¡°íšŒ
- **ì§€ì—°ë¡œë”© ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´ ``` hibernate.default_batch_fetch_size``` , ```@BatchSize```ë¥¼ ì ìš©!**
    - hibernate.default_batch_fetch_size: ê¸€ë¡œë²Œ ì„¤ì •
    - @BatchSize: ê°œë³„ ìµœì í™”
    - ì´ ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ì»¬ë ‰ì…˜ì´ë‚˜, í”„ë¡ì‹œ ê°ì²´ë¥¼ í•œêº¼ë²ˆì— ì„¤ì •í•œ size ë§Œí¼ IN ì¿¼ë¦¬ë¡œ ì¡°íšŒí•¨

```
    @GetMapping("/api/v3.1/orders")
    public List<OrderDto> orderV3_page(
            @RequestParam(value="offset", defaultValue = "0") int offset,
            @RequestParam(value="limit", defaultValue = "100") int limit) {
        List<Order> orders = orderRepository.findAllWithMemberDelivery(offset, limit); // ToOneë§Œ í˜ì¹˜ì¡°ì¸(í˜ì´ì§• ê°€ëŠ¥)
        
        return orders.stream()
                .map(o -> new OrderDto(o))
                .collect(Collectors.toList());
    }

    âœ… OrderRepository - ì¶”ê°€ ì½”ë“œ
    public List<Order> findAllWithMemberDelivery(int offset, int limit) {
        return em.createQuery("select o from Order o " +
                        " join fetch o.member m" +
                        " join fetch o.delivery d", Order.class)
                .setFirstResult(offset)
                .setMaxResults(limit)
                .getResultList();
    }

    âœ… ìµœì í™” ì˜µì…˜
    spring:
        jpa:
            properties:
                hibernate:
                    default_batch_fetch_size: 1000

    ê°œë³„ë¡œ ì„¤ì •í•˜ë ¤ë©´ @BatchSize ë¥¼ ì ìš©í•˜ë©´ ëœë‹¤. (ì»¬ë ‰ì…˜ì€ ì»¬ë ‰ì…˜ í•„ë“œì—, ì—”í‹°í‹°ëŠ” ì—”í‹°í‹° í´ë˜ìŠ¤ì—
ì ìš©)

```

- **ì¥ì **
    - ì¿¼ë¦¬ í˜¸ì¶œ ìˆ˜ê°€ ```1 + N``` â¡ï¸ ```1 + 1``` ë¡œ ìµœì í™” ë¨
    - ì¡°ì¸ë³´ë‹¤ DB ë°ì´í„° ì „ì†¡ëŸ‰ì´ ìµœì í™” ë¨

    (Orderì™€ OrderItemì„ ì¡°ì¸í•˜ë©´ Orderê°€ OrderItem ë§Œí¼ ì¤‘ë³µí•´ì„œ ì¡°íšŒë¨. ì´ ë°©ë²•ì€ ê°ê° ì¡°íšŒí•˜ë¯€ë¡œ ì „ì†¡í•´ì•¼í•  ì¤‘ë³µ ë°ì´í„°ê°€ ì—†ìŒ.)
    - í˜ì¹˜ ì¡°ì¸ ë°©ì‹ê³¼ ë¹„êµí•´ì„œ ì¿¼ë¦¬ í˜¸ì¶œ ìˆ˜ê°€ ì•½ê°„ ì¦ê°€í•˜ì§€ë§Œ, DB ë°ì´í„° ì „ì†¡ëŸ‰ì´ ê°ì†Œ
    - ì»¬ë ‰ì…˜ í˜ì¹˜ ì¡°ì¸ì€ í˜ì´ì§•ì´ ë¶ˆê°€ëŠ¥í•˜ì§€ë§Œ ì´ ë°©ë²•ì€ í˜ì´ì§• ê°€ëŠ¥

<br>

#### â­ **ê²°ë¡ **

ToOne ê´€ê³„ëŠ” í˜ì¹˜ ì¡°ì¸í•´ë„ í˜ì´ì§•ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŒ.

ë”°ë¼ì„œ ToOne ê´€ê³„ëŠ” í˜ì¹˜ì¡°ì¸ìœ¼ë¡œ ì¿¼ë¦¬ ìˆ˜ë¥¼ ì¤„ì—¬ í•´ê²°í•˜ê³ , ë‚˜ë¨¸ì§€ëŠ” batch sizeë¡œ ìµœì í™”!

<br>

> ì°¸ê³ : default_batch_fetch_size ì˜ í¬ê¸°ëŠ” ì ë‹¹í•œ ì‚¬ì´ì¦ˆë¥¼ ê³¨ë¼ì•¼ í•˜ëŠ”ë°, 100~1000 ì‚¬ì´ë¥¼
ì„ íƒí•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤. ì´ ì „ëµì„ SQL IN ì ˆì„ ì‚¬ìš©í•˜ëŠ”ë°, ë°ì´í„°ë² ì´ìŠ¤ì— ë”°ë¼ IN ì ˆ íŒŒë¼ë¯¸í„°ë¥¼
1000ìœ¼ë¡œ ì œí•œí•˜ê¸°ë„ í•œë‹¤. 1000ìœ¼ë¡œ ì¡ìœ¼ë©´ í•œë²ˆì— 1000ê°œë¥¼ DBì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë¶ˆëŸ¬ì˜¤ë¯€ë¡œ DB
ì— ìˆœê°„ ë¶€í•˜ê°€ ì¦ê°€í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ 100ì´ë“  1000ì´ë“  ê²°êµ­ ì „ì²´ ë°ì´í„°ë¥¼ ë¡œë”©í•´ì•¼
í•˜ë¯€ë¡œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ê°™ë‹¤. 1000ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì´ ì„±ëŠ¥ìƒ ê°€ì¥ ì¢‹ì§€ë§Œ, ê²°êµ­ DBë“  ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë“ 
ìˆœê°„ ë¶€í•˜ë¥¼ ì–´ë””ê¹Œì§€ ê²¬ë”œ ìˆ˜ ìˆëŠ”ì§€ë¡œ ê²°ì •í•˜ë©´ ëœë‹¤.

<br><Br>

### ì£¼ë¬¸ ì¡°íšŒ V4 : JPAì—ì„œ DTO ì§ì ‘ ì¡°íšŒ

```
    @GetMapping("/api/v4/orders")
    public List<OrderQueryDto> orderV4(){
        return orderQueryRepository.findOrderQueryDtos();
    }

    âœ… OrderRepository - ì¶”ê°€ ì½”ë“œ

    public List<OrderQueryDto> findOrderQueryDtos() {
        List<OrderQueryDto> result = findOrders(); // query 1ë²ˆ -> Nê°œ

        result.forEach(o -> {
             List<OrderItemQueryDto> orderItems = findOrderItems(o.getOrderId()); // query Nê°œ ë‚˜ê°
             o.setOrderItems(orderItems);
        });
        return result;
    }

    // ToOne ê´€ê³„ find

    private List<OrderQueryDto> findOrders() {
        return em.createQuery("select new jpabook.jpashop.repository.order.query.OrderQueryDto(o.id, m.name, o.orderDate, o.status, d.address)" +
                        "from Order o " +
                        " join o.member m" +
                        " join o.delivery d", OrderQueryDto.class)
                .getResultList();
    }

    // ToMany ê´€ê³„ find

    private List<OrderItemQueryDto> findOrderItems(long orderId) {
        return em.createQuery("select new jpabook.jpashop.repository.order.query.OrderItemQueryDto(oi.order.id,i.name,oi.orderPrice, oi.count )" +
                " from OrderItem oi" +
                " join oi.item i" +
                " where oi.order.id = :orderId", OrderItemQueryDto.class)
                .setParameter("orderId", orderId)
                .getResultList();
    }

```

- ì¿¼ë¦¬: ë£¨íŠ¸ 1ë²ˆ, ì»¬ë ‰ì…˜ Në²ˆ ì‹¤í–‰(N+1ë¬¸ì œ ë°œìƒ)
- ToOne(N:1, 1:1) ê´€ê³„ë“¤ì„ ë¨¼ì € ì¡°íšŒí•˜ê³ , ToMany(1:N) ê´€ê³„ëŠ” ê°ê° ë³„ë„ë¡œ ì²˜ë¦¬
    - ì´ ë°©ì‹ì„ ì±„íƒí•œ ì´ìœ 
    - 1ï¸âƒ£ ToOne ê´€ê³„ëŠ” ì¡°ì¸í•´ë„ ë°ì´í„° row ì¦ê°€ x
    - 2ï¸âƒ£ ToMany(1:N) ê´€ê³„ëŠ” ì¡°ì¸í•˜ë©´ row ì¦ê°€
- row ìˆ˜ê°€ ì¦ê°€í•˜ì§€ ì•ŠëŠ” ToOne ê´€ê³„ëŠ” ì¡°ì¸ìœ¼ë¡œ ìµœì í™”í•˜ê¸° ì‰¬ìš°ë¯€ë¡œ í•œë²ˆì— ì¡°íšŒ, ToMany ê´€ê³„ëŠ” ìµœì í™” í•˜ê¸° ì–´ë ¤ìš°ë¯€ë¡œ ```findOrderItems()``` ê°™ì€ ë³„ë„ì˜ ë©”ì„œë“œë¡œ ì¡°íšŒ

<br><Br>

### ì£¼ë¬¸ ì¡°íšŒ V5 : JPAì—ì„œ DTO ì§ì ‘ ì¡°íšŒ - ì»¬ë ‰ì…˜ ì¡°íšŒ ìµœì í™”

```
    @GetMapping("/api/v5/orders")
    public List<OrderQueryDto> orderV5(){
        return orderQueryRepository.findOrderQueryDto_optimization();

    }

    âœ… OrderRepository - ì¶”ê°€ ì½”ë“œ

    public List<OrderQueryDto> findOrderQueryDto_optimization() {

        List<OrderQueryDto> result = findOrders(); // query 1ë²ˆ : order find

        Map<Long, List<OrderItemQueryDto>> orderItemMap = findOrderItemMap(toOrderIds(result));

        result.forEach(o -> o.setOrderItems(orderItemMap.get(o.getOrderId())));
        // orderIdë¡œ orderItemListë¥¼ ê°€ì ¸ì™€ orderì˜ orderItemì— set
        return result;
    }

    private Map<Long, List<OrderItemQueryDto>> findOrderItemMap(List<Long> orderIds) {
        List<OrderItemQueryDto> orderItems = em.createQuery("select new jpabook.jpashop.repository.order.query.OrderItemQueryDto(oi.order.id,i.name,oi.orderPrice, oi.count )" +
                        " from OrderItem oi" +
                        " join oi.item i" +
                        " where oi.order.id in :orderIds", OrderItemQueryDto.class)
                .setParameter("orderIds", orderIds)
                .getResultList(); // query 1ë²ˆ : orderItem find

        // ì¿¼ë¦¬ í•œë²ˆ ë‚ ë¦¬ê³  ë©”ëª¨ë¦¬ì—ì„œ ë§µìœ¼ë¡œ orderItem ë§¤ì¹­(orderì™€ orderItem) = ì¿¼ë¦¬ ì´ 2ë²ˆ ë‚˜ê°
        Map<Long, List<OrderItemQueryDto>> orderItemMap = orderItems.stream()
                .collect(Collectors.groupingBy(orderItemQueryDto -> orderItemQueryDto.getOrderId()));
        // orderIdë¥¼ keyë¡œ í•˜ê³  orderItemListë¥¼ valueë¡œ í•˜ëŠ” map ìƒì„±
        return orderItemMap;
    }

    private static List<Long> toOrderIds(List<OrderQueryDto> result) {
        List<Long> orderIds = result.stream()
                .map(o -> o.getOrderId())
                .collect(Collectors.toList()); // orderId ë¦¬ìŠ¤íŠ¸ ìƒì„±
        return orderIds;
    }

```
- query: ë£¨íŠ¸ 1ë²ˆ, ì»¬ë ‰ì…˜ 1ë²ˆ
- ToOne ê´€ê³„ë“¤ì„ ë¨¼ì € ì¡°íšŒí•˜ê³ , ì—¬ê¸°ì„œ ì–»ì€ ì‹ë³„ì orderIdë¡œ ToMany ê´€ê³„ì¸ OrderItemì„ í•œêº¼ë²ˆì— ì¡°íšŒ
- MAPì„ ì‚¬ìš©í•´ì„œ ë§¤ì¹­ì„±ëŠ¥ í–¥ìƒ(O(1))

<BR><bR>

### ì£¼ë¬¸ ì¡°íšŒ V6: JPAì—ì„œ DTOë¡œ ì§ì ‘ ì¡°íšŒ, í”Œë« ë°ì´í„° ìµœì í™”

```
@GetMapping("/api/v6/orders")
    public List<OrderQueryDto> orderV6(){
        List<OrderFlatDto> flats = orderQueryRepository.findOrderQueryDto_flat();

        // OrderFlatDto -> OrderQueryDto
        return flats.stream()
                .collect(groupingBy(o -> new OrderQueryDto(o.getOrderId(), o.getName(), o.getOrderDate(), o.getOrderStatus(), o.getAddress()),
                        mapping(o -> new OrderItemQueryDto(o.getOrderId(), o.getItemName(), o.getOrderPrice(), o.getCount()), toList())
                )).entrySet().stream()
                .map(e -> new OrderQueryDto(e.getKey().getOrderId(), e.getKey().getName(), e.getKey().getOrderDate(), e.getKey().getOrderStatus(), e.getKey().getAddress(), e.getValue()))
                .collect(toList());
    }
```
- queyr : 1ë²ˆ
- ë‹¨ì 
    - ì¿¼ë¦¬ëŠ” í•œë²ˆì´ì§€ë§Œ ì¡°ì¸ìœ¼ë¡œ ì¸í•´ DBì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì „ë‹¬í•˜ëŠ” ë°ì´í„°ì— ì¤‘ë³µ ë°ì´í„°ê°€ ì¶”ê°€ë˜ë¯€ë¡œ ìƒí™©ì— ë”°ë¼ V5ë³´ë‹¤ ë” ëŠë¦´ ìˆ˜ ìˆìŒ
    - ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì¶”ê°€ ì‘ì—…ì´ í¼
    - í˜ì´ì§€ ë¶ˆê°€ëŠ¥(ORDERë¥¼ ê¸°ì¤€ìœ¼ë¡œ í• ë•Œ)


<BR><bR>


